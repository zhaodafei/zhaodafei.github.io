<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>BlueLake 主题配置</title>
      <link href="/2018/03/26/hexo/hexo-BlueLake/"/>
      <url>/2018/03/26/hexo/hexo-BlueLake/</url>
      <content type="html"><![CDATA[<h3 id="添加本地搜索"><a href="#添加本地搜索" class="headerlink" title="添加本地搜索"></a>添加本地搜索</h3><p>安装插件<a href="https://github.com/alexbruno/hexo-generator-json-content" target="_blank" rel="noopener">hexo-generator-json-content</a>来创建JSON数据文件</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span> hexo-generator-<span class="keyword">json</span>-<span class="keyword">content</span>@<span class="number">2.2</span><span class="number">.0</span> <span class="comment">--save</span></span><br></pre></td></tr></table></figure><p>在根配置  _config.yml  添加配置</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jsonContent:</span></span><br><span class="line"><span class="attr">  meta:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">  pages:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">  posts:</span></span><br><span class="line"><span class="attr">    title:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    date:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    path:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    text:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    raw:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    content:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    slug:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    updated:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    comments:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    link:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    permalink:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    excerpt:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    categories:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    tags:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>在主题 _config.yml 中添加</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">local_search:</span> <span class="literal">true</span>      <span class="comment">#安装好 BlueLake主题后，会有这个配置</span></span><br></pre></td></tr></table></figure><p><img src="/img/hexo/BlueLake_config/search_01.png" alt="站内搜索" title="站内搜索"></p><p><img src="/img/hexo/BlueLake_config/search_02.png" alt="站内搜索" title="站内搜索"></p><p><img src="/img/hexo/BlueLake_config/search_03.png" alt="站内搜索" title="站内搜索"></p><p> <a href="http://example.com/" title="这里是title" target="_blank" rel="noopener">我是a里面的内容</a></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>linux ubuntu16 swoole</title>
      <link href="/2018/03/21/ubuntu/linux_ubuntu_swoole/"/>
      <url>/2018/03/21/ubuntu/linux_ubuntu_swoole/</url>
      <content type="html"><![CDATA[<h3 id="swoole"><a href="#swoole" class="headerlink" title="swoole"></a>swoole</h3><p>php7 中安装swoole1.9.1</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">安装依赖</span><br><span class="line">apt-get <span class="keyword">install</span> libpcre3 libpcre3-dev  </span><br><span class="line"></span><br><span class="line">*********************************************</span><br><span class="line"></span><br><span class="line">cd  /<span class="keyword">data</span>/<span class="keyword">server</span>/</span><br><span class="line">wget https://github.com/swoole/swoole-src/<span class="keyword">archive</span>/v1<span class="number">.9</span><span class="number">.1</span>-stable.tar.gz</span><br><span class="line">tar zxvf v1<span class="number">.9</span><span class="number">.1</span>-stable.tar.gz</span><br><span class="line">cd swoole-src<span class="number">-1.9</span><span class="number">.1</span>-stable</span><br><span class="line"></span><br><span class="line">/<span class="keyword">data</span>/<span class="keyword">server</span>/php7/<span class="keyword">bin</span>/phpize</span><br><span class="line">【</span><br><span class="line">这一步很少出问题： 我的报错如下：</span><br><span class="line">错误一：</span><br><span class="line">root@ubuntu:/<span class="keyword">data</span>/<span class="keyword">server</span>/swoole-src<span class="number">-1.9</span><span class="number">.1</span>-stable# /<span class="keyword">data</span>/<span class="keyword">server</span>/php7/<span class="keyword">bin</span>/phpize</span><br><span class="line">Configuring <span class="keyword">for</span>:</span><br><span class="line">PHP Api <span class="keyword">Version</span>:         <span class="number">20151012</span></span><br><span class="line">Zend <span class="keyword">Module</span> Api <span class="keyword">No</span>:      <span class="number">20151012</span></span><br><span class="line">Zend Extension Api <span class="keyword">No</span>:   <span class="number">320151012</span></span><br><span class="line">Cannot find autoconf. Please <span class="keyword">check</span> your autoconf installation <span class="keyword">and</span> the</span><br><span class="line">$PHP_AUTOCONF environment variable. <span class="keyword">Then</span>, rerun this script.</span><br><span class="line">错误二:</span><br><span class="line">Cannot find config.m4. </span><br><span class="line">Make sure that you run <span class="string">'/data/server/php7/bin/phpize'</span> <span class="keyword">in</span> the top <span class="keyword">level</span> <span class="keyword">source</span> <span class="keyword">directory</span> <span class="keyword">of</span> the <span class="keyword">module</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">解决方法：</span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> m4</span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> autoconf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">】</span><br><span class="line">./configure <span class="comment">--with-php-config=/data/server/php7/bin/php-config</span></span><br><span class="line">make</span><br><span class="line">make <span class="keyword">install</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">最后安装成功后显示：</span><br><span class="line">root@ubuntu:/<span class="keyword">data</span>/<span class="keyword">server</span>/swoole-src<span class="number">-1.9</span><span class="number">.1</span>-stable# make <span class="keyword">install</span></span><br><span class="line">Installing <span class="keyword">shared</span> extensions:     /<span class="keyword">data</span>/<span class="keyword">server</span>/php7/lib/php/extensions/<span class="keyword">no</span>-debug-non-zts<span class="number">-20151012</span>/</span><br><span class="line">root@ubuntu:/<span class="keyword">data</span>/<span class="keyword">server</span>/swoole-src<span class="number">-1.9</span><span class="number">.1</span>-stable#</span><br></pre></td></tr></table></figure><h3 id="配置php支持swoole"><a href="#配置php支持swoole" class="headerlink" title="配置php支持swoole"></a>配置php支持swoole</h3><p>vi  /data/server/php7/lib/php.ini   #######编辑配置文件，在最后一行添加以下内容(查找php.ini最好的方法就是phpinfo)</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/php/<span class="number">7.0</span>/cli/php.ini</span><br><span class="line">vi  /data/server/php7/<span class="class"><span class="keyword">lib</span>/<span class="title">php</span>.<span class="title">ini</span>  </span></span><br><span class="line">这两个里面都要写上一以下内容：</span><br><span class="line"></span><br><span class="line">extension=swoole.so</span><br></pre></td></tr></table></figure><h3 id="重启php-fpm"><a href="#重启php-fpm" class="headerlink" title="重启php-fpm"></a>重启php-fpm</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">插找PHP服务 ps aux | <span class="keyword">grep</span> php-fpm</span><br><span class="line">pkill -<span class="number">9</span> php</span><br><span class="line">php启动命令</span><br><span class="line"><span class="regexp">/data/</span>server<span class="regexp">/php7/</span>sbin<span class="regexp">/php-fpm</span></span><br></pre></td></tr></table></figure><p>先用 php -m 看一下,没有 swoole ，扩展，检索一下  locate php.ini   ,发现在  /etc/php/7.0/cli/php.ini  这里还有一个，这里也加上  extension=swoole.so   ，在看看有没有，如果还是没有，   php -ini|grep ‘extesion_dir’  看一下，发现如下错误：</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@<span class="symbol">ubuntu:</span>/home/afei<span class="comment"># php -ini|grep 'extesion_dir'</span></span><br><span class="line">PHP <span class="symbol">Warning:</span>  PHP <span class="symbol">Startup:</span> Unable to load dynamic library <span class="string">'/usr/lib/php/20151012/swoole.so'</span> - <span class="regexp">/usr/lib</span><span class="regexp">/php/</span><span class="number">20151012</span>/swoole.<span class="symbol">so:</span> cannot open shared object <span class="symbol">file:</span> No such file or directory in Unknown on line <span class="number">0</span></span><br><span class="line">root@<span class="symbol">ubuntu:</span>/home/afei<span class="comment"># cd  /usr/lib/php/20151012</span></span><br><span class="line">root@<span class="symbol">ubuntu:</span>/usr/<span class="class"><span class="keyword">lib</span>/<span class="title">php</span>/20151012<span class="comment"># ls -l</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">解决办法， 拷贝一份过去： </span><br><span class="line">cp /data/server/php7/<span class="class"><span class="keyword">lib</span>/<span class="title">php</span>/<span class="title">extensions</span>/<span class="title">no</span>-<span class="title">debug</span>-<span class="title">non</span>-<span class="title">zts</span>-20151012/<span class="title">swoole</span>.<span class="title">so</span>  /<span class="title">usr</span>/<span class="title">lib</span>/<span class="title">php</span>/20151012/</span></span><br></pre></td></tr></table></figure><p>在phpinfo页面可以看到关于swoole的选项，说明安装成功</p><p><img src="/img/ubuntu/swoole/swoole_success.png" alt="swoole 安装成功" title="swoole 安装成功"></p><p> <a href="https://wiki.swoole.com/wiki/page/6.html" title="swoole官方文档" target="_blank" rel="noopener">swoole官方文档</a></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>linux ubuntu15 tengine</title>
      <link href="/2018/03/17/ubuntu/linux_ubuntu_tengine/"/>
      <url>/2018/03/17/ubuntu/linux_ubuntu_tengine/</url>
      <content type="html"><![CDATA[<p>Tengine 官网安装相当简略，这里详细安装一次（ubuntu15 安装 tengine）</p><h3 id="安装必要的编译环境"><a href="#安装必要的编译环境" class="headerlink" title="安装必要的编译环境"></a>安装必要的编译环境</h3><p>Tengine 安装需要使用源代码自行编译，所以安装前需要安装必要的编译工具</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="builtin-name">get</span> update</span><br><span class="line">sudo apt-<span class="builtin-name">get</span> install g++</span><br><span class="line">apt-<span class="builtin-name">get</span> install libgd-dev</span><br></pre></td></tr></table></figure><h3 id="安装所需要的组件【pcre、openssl、zlib】，组件安装的时候注意路径"><a href="#安装所需要的组件【pcre、openssl、zlib】，组件安装的时候注意路径" class="headerlink" title="安装所需要的组件【pcre、openssl、zlib】，组件安装的时候注意路径"></a>安装所需要的组件【pcre、openssl、zlib】，组件安装的时候注意路径</h3><h4 id="PCRE"><a href="#PCRE" class="headerlink" title="PCRE"></a>PCRE</h4><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wget <span class="symbol">ftp:</span>/<span class="regexp">/ftp.csx.cam.ac.uk/pub</span><span class="regexp">/software/programming</span><span class="regexp">/pcre/pcre</span>-<span class="number">8.38</span>.tar.gz</span><br><span class="line">解压到你指定的目录</span><br><span class="line">tar -zxvf pcre-<span class="number">8.38</span>.tar.gz -C /data/server/tengine_component</span><br><span class="line">mv pcre-<span class="number">8.38</span> pcre</span><br><span class="line">cd pcre/</span><br><span class="line">./configure --prefix=<span class="regexp">/data/server</span><span class="regexp">/tengine_component/pcre</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/tengine/component_pcre.png" alt="pcre 组件" title="pcre 组件"></p><h3 id="OpenSSL"><a href="#OpenSSL" class="headerlink" title="OpenSSL"></a>OpenSSL</h3><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wget <span class="symbol">http:</span>/<span class="regexp">/www.openssl.org/source</span><span class="regexp">/openssl-1.0.2.tar.gz</span></span><br><span class="line"><span class="regexp">解压到你指定的目录</span></span><br><span class="line"><span class="regexp">tar -zxvf openssl-1.0.2.tar.gz -C /data</span><span class="regexp">/server/tengine</span>_component</span><br><span class="line">mv openssl-<span class="number">1.0</span>.<span class="number">2</span> openssl</span><br><span class="line">cd openssl/</span><br><span class="line">./config --prefix=<span class="regexp">/data/server</span><span class="regexp">/tengine_component/openssl</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p>这个执行时间稍微长一点  </p><p><img src="/img/ubuntu/tengine/component_openssl.png" alt="OpenSSL  组件" title="OpenSSL 组件"></p><h3 id="Zlib"><a href="#Zlib" class="headerlink" title="Zlib"></a>Zlib</h3><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wget http://<span class="literal">zlib</span>.net/<span class="literal">zlib</span>-<span class="number">1.2</span>.<span class="number">11</span>.tar.gz</span><br><span class="line">解压到你指定的目录</span><br><span class="line">tar -zxvf <span class="literal">zlib</span>-<span class="number">1.2</span>.<span class="number">11</span>.tar.gz -C /data/server/tengine_component</span><br><span class="line">mv <span class="literal">zlib</span>-<span class="number">1.2</span>.<span class="number">11</span> <span class="literal">zlib</span></span><br><span class="line">cd <span class="literal">zlib</span>/</span><br><span class="line">./configure --prefix=/data/server/tengine_component/<span class="literal">zlib</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/tengine/component_Zlib.png" alt="Zlib  组件" title="Zlib 组件"></p><h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###有空试试这个不添加应该也是可以的，安装完有2个报错，不用理会，手动创建 logs 目录，修改权限；###</span></span><br><span class="line">groupadd www</span><br><span class="line">useradd -s /sbin/nologin -g www www</span><br><span class="line"><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">////</span><span class="regexp">///</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">wget http://</span>tengine.taobao.org/download/tengine-<span class="number">2.1</span>.<span class="number">2.tar</span>.gz</span><br><span class="line">解压到你指定的目录</span><br><span class="line">tar -zxvf tengine-<span class="number">2.1</span>.<span class="number">2.tar</span>.gz -C <span class="regexp">/data/server/</span></span><br><span class="line">mv tengine-<span class="number">2.1</span>.<span class="number">2</span> tengine</span><br><span class="line">cd tengine</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">./configure --prefix=/data/server/tengine <span class="string">\</span></span><br><span class="line">--<span class="keyword">with</span>-pcre=/data/server/tengine_component/pcre <span class="string">\</span></span><br><span class="line">--<span class="keyword">with</span>-openssl=/data/server/tengine_component/openssl <span class="string">\</span></span><br><span class="line">--<span class="keyword">with</span>-http_gzip_static_module <span class="string">\</span></span><br><span class="line">--<span class="keyword">with</span>-http_realip_module <span class="string">\</span></span><br><span class="line">--<span class="keyword">with</span>-http_stub_status_module <span class="string">\</span></span><br><span class="line">--<span class="keyword">with</span>-http_concat_module <span class="string">\</span></span><br><span class="line">--<span class="keyword">with</span>-zlib=/data/server/tengine_component/zlib</span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p>注意配置的时候 –with-pcre 、–with-openssl、–with-zlib的路径为源文件的路径</p><p><img src="/img/ubuntu/tengine/tengine_install.png" alt="tengine install" title="tengine install"></p><h3 id="检测是否可用"><a href="#检测是否可用" class="headerlink" title="检测是否可用"></a>检测是否可用</h3><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta-keyword">/data/</span>server<span class="meta-keyword">/tengine/</span>sbin/nginx -t</span><br><span class="line"></span><br><span class="line">没有logs目录，那就创建一个logs目录： mkdir logs</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/tengine/tengine_check.png" alt="tengine check" title="tengine check"></p><p><img src="/img/ubuntu/tengine/tengine_ok.png" alt="tengine ok" title="tengine ok"></p><h3 id="启动关闭命令"><a href="#启动关闭命令" class="headerlink" title="启动关闭命令"></a>启动关闭命令</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/data/</span>server<span class="regexp">/tengine/</span>sbin/nginx -t</span><br><span class="line"><span class="regexp">/data/</span>server<span class="regexp">/tengine/</span>sbin/nginx -s start</span><br><span class="line"><span class="regexp">/data/</span>server<span class="regexp">/tengine/</span>sbin/nginx -s stop</span><br><span class="line"><span class="regexp">/data/</span>server<span class="regexp">/tengine/</span>sbin/nginx -s reload</span><br><span class="line"></span><br><span class="line">pid出错时，可以使用这个：</span><br><span class="line"><span class="regexp">/data/</span>server<span class="regexp">/tengine/</span>sbin<span class="regexp">/nginx  -c /</span>data<span class="regexp">/server/</span>tengine<span class="regexp">/conf/</span>nginx.conf</span><br></pre></td></tr></table></figure><p>扩展：有时候，我们有好多域名，为了方便我们修改一下 nginx.conf  ,修改内容如下，主要是最后一句 include servers/*;然后在nginx.conf 当前位置创建 servers 目录；【修改之前记得把原来的备份  cp nginx.conf nginx.conf_backups  】</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">user  nobody;</span></span><br><span class="line">worker_processes  1;</span><br><span class="line"><span class="meta">#</span><span class="bash">error_log  logs/error.log;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">error_log  logs/error.log  notice;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">error_log  logs/error.log  info;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">pid        logs/nginx.pid;</span></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> load modules compiled as Dynamic Shared Object (DSO)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">dso &#123;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    load ngx_http_fastcgi_module.so;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    load ngx_http_rewrite_module.so;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">&#125;</span></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    charset utf-8;</span><br><span class="line"><span class="meta">#</span><span class="bash">    server_tokens off;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    server_names_hash_bucket_size 128;</span></span><br><span class="line"><span class="meta"> #</span><span class="bash">   client_header_buffer_size 32k;</span></span><br><span class="line"><span class="meta"> #</span><span class="bash">   large_client_header_buffers 4 32k;</span></span><br><span class="line"><span class="meta">  #</span><span class="bash">  client_max_body_size 20m;</span></span><br><span class="line"><span class="meta">   #</span><span class="bash"> client_body_buffer_size  128k;</span></span><br><span class="line">    client_header_timeout 30m;</span><br><span class="line">    client_body_timeout 30m;</span><br><span class="line"><span class="meta">   #</span><span class="bash"> client_body_temp_path /dev/shm/client_body_temp_path 1 2;</span></span><br><span class="line">    send_timeout 30m;</span><br><span class="line">    #sendfile on;</span><br><span class="line"><span class="meta">   #</span><span class="bash"> tcp_nopush on;</span></span><br><span class="line"><span class="meta">   #</span><span class="bash"> tcp_nodelay on;</span></span><br><span class="line">    keepalive_timeout 60;</span><br><span class="line"><span class="meta">   #</span><span class="bash"> fastcgi_connect_timeout 300;</span></span><br><span class="line"><span class="meta">   #</span><span class="bash"> fastcgi_send_timeout 300;</span></span><br><span class="line"><span class="meta">   #</span><span class="bash"> fastcgi_read_timeout 300;</span></span><br><span class="line"><span class="meta">   #</span><span class="bash"> fastcgi_buffer_size 256k;</span></span><br><span class="line"><span class="meta">   #</span><span class="bash"> fastcgi_buffers 4 256k;</span></span><br><span class="line"><span class="meta">   #</span><span class="bash"> fastcgi_busy_buffers_size 512k;</span></span><br><span class="line"><span class="meta">   #</span><span class="bash"> fastcgi_temp_file_write_size 512k;</span></span><br><span class="line"><span class="meta">   #</span><span class="bash"> fastcgi_temp_path /dev/shm/factcgi_temp_path 1 2;</span></span><br><span class="line"><span class="meta">   #</span><span class="bash"> fastcgi_cache_path   /dev/shm/fastcgi_cache  levels=1:2  keys_zone=PHPCACHE:1024m inactive=15m;</span></span><br><span class="line"><span class="meta">   #</span><span class="bash"> fastcgi_cache_key <span class="string">"<span class="variable">$scheme</span><span class="variable">$request_method</span><span class="variable">$host</span><span class="variable">$request_uri</span>"</span>;</span></span><br><span class="line"><span class="meta">   #</span><span class="bash"> fastcgi_cache_use_stale error  timeout invalid_header http_500;</span></span><br><span class="line"><span class="meta">   #</span><span class="bash"> fastcgi_intercept_errors on;    <span class="comment">#开启后支持4XX 和 5XX 错误自定义</span></span></span><br><span class="line">    gzip on;</span><br><span class="line">    gzip_vary on;</span><br><span class="line">    gzip_min_length  10k;</span><br><span class="line">    gzip_buffers     4 16k;</span><br><span class="line">    gzip_http_version 1.0;</span><br><span class="line">    gzip_comp_level 2;</span><br><span class="line">    gzip_types   text/plain text/css text/xml text/javascript application/x-javascript application/xml application/javascript;</span><br><span class="line">    gzip_disable  "MSIE [1-6]\.";</span><br><span class="line">    include servers/*;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>demo 测试，在新建的 servers 目录下创建 文件 127.0.0.1</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       <span class="number">80</span>;</span><br><span class="line">    server_name  <span class="number">127.0.</span><span class="number">0.1</span>;</span><br><span class="line">    client_max_body_size 0m;</span><br><span class="line">    charset utf-<span class="number">8</span>;</span><br><span class="line">    #access_log /<span class="keyword">data</span>/server/tengine/logs/<span class="number">127.0.</span><span class="number">0.</span>_access.<span class="built_in">log</span>;</span><br><span class="line">    #error_log  /<span class="keyword">data</span>/server/tengine/logs/<span class="number">127.0.</span><span class="number">0.</span>_error.<span class="built_in">log</span>;</span><br><span class="line">    root  /<span class="keyword">data</span>/www/;</span><br><span class="line">    <span class="built_in">index</span> <span class="built_in">index</span>.html;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">或者：</span><br><span class="line">server &#123;</span><br><span class="line">    listen       <span class="number">80</span>;</span><br><span class="line">    server_name  <span class="number">127.0.</span><span class="number">0.1</span> <span class="number">192.168.</span><span class="number">1.232</span>;</span><br><span class="line">    client_max_body_size 0m;</span><br><span class="line">    charset utf-<span class="number">8</span>;</span><br><span class="line">    #access_log /<span class="keyword">data</span>/server/tengine/logs/<span class="number">127.0.</span><span class="number">0.</span>_access.<span class="built_in">log</span>;</span><br><span class="line">    #error_log  /<span class="keyword">data</span>/server/tengine/logs/<span class="number">127.0.</span><span class="number">0.</span>_error.<span class="built_in">log</span>;</span><br><span class="line">    root  /<span class="keyword">data</span>/www/;</span><br><span class="line">    <span class="built_in">index</span> <span class="built_in">index</span>.html <span class="built_in">index</span>.php;</span><br><span class="line">    </span><br><span class="line">    location ~ .+\.php($|/) &#123;</span><br><span class="line">        fastcgi_pass <span class="number">127.0.</span><span class="number">0.1</span>:<span class="number">9000</span>;</span><br><span class="line">        fastcgi_index <span class="built_in">index</span>.php;</span><br><span class="line">        <span class="keyword">include</span> fastcgi.conf;</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/tengine/demo_test01.png" alt="demo_test01" title="demo_test01"></p><p><img src="/img/ubuntu/tengine/demo_test01.png" alt="demo_test02" title="demo_test02"></p><p><a href="http://tengine.taobao.org/document_cn/install_cn.html" title="Tengine 官网安装" target="_blank" rel="noopener">Tengine 官网安装</a></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>linux ubuntu15 mysql</title>
      <link href="/2018/03/17/ubuntu/linux_ubuntu_mysql/"/>
      <url>/2018/03/17/ubuntu/linux_ubuntu_mysql/</url>
      <content type="html"><![CDATA[<h3 id="mysql-安装"><a href="#mysql-安装" class="headerlink" title="mysql 安装"></a>mysql 安装</h3><h3 id="在终端执行-以下命令"><a href="#在终端执行-以下命令" class="headerlink" title="在终端执行 以下命令"></a>在终端执行 以下命令</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get <span class="keyword">install</span> mysql-<span class="keyword">server</span></span><br><span class="line">sudo apt <span class="keyword">install</span> mysql-<span class="keyword">client</span></span><br><span class="line">sudo apt <span class="keyword">install</span> libmysqlclient-dev</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/mysql/fast_mysql_install.png" alt="mysql install" title="mysql install"></p><p>安装完用以下命测试,出现图中说明 OK</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo netstat -tap <span class="string">| grep mysql</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/mysql/fast_mysql_check.png" alt="mysql check" title="mysql check"></p><h3 id="进入-mysql"><a href="#进入-mysql" class="headerlink" title="进入 mysql"></a>进入 mysql</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -<span class="selector-tag">p</span>   然后回车输入密码</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/mysql/fast_show_databases.png" alt="show databases" title="show databases"></p><h3 id="设置-mysql-运行远程访问"><a href="#设置-mysql-运行远程访问" class="headerlink" title="设置 mysql 运行远程访问"></a>设置 mysql 运行远程访问</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/mysql/mysql<span class="selector-class">.conf</span><span class="selector-class">.d</span>/mysqld.cnf</span><br></pre></td></tr></table></figure><p>1、注释掉  bind-address  = 127.0.0.1  保存退出【在43行】<br>2、grant all on <em>.</em> to root@’%’ identified by ‘你的密码’ with grant option;<br>3、flush privileges;<br>4、exit; 退出 mysql服务<br>5、重启服务： service mysql restart</p><p><img src="/img/ubuntu/mysql/fast_remote_connection.png" alt="remote connection" title="remote connection"></p><h3 id="卸载mysql"><a href="#卸载mysql" class="headerlink" title="卸载mysql"></a>卸载mysql</h3><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> <span class="built_in">remove</span> mysql-server</span><br><span class="line">sudo apt-<span class="built_in">get</span> autoremove mysql-server</span><br><span class="line">sudo apt-<span class="built_in">get</span> <span class="built_in">remove</span> mysql-common <span class="comment">//这个很重要</span></span><br><span class="line"></span><br><span class="line">清理残留数据；</span><br><span class="line">dpkg -l |grep ^rc|awk <span class="string">'&#123;print $2&#125;'</span> |sudo xargs dpkg -P</span><br></pre></td></tr></table></figure><h2 id="mysql-手动安装"><a href="#mysql-手动安装" class="headerlink" title="mysql 手动安装"></a>mysql 手动安装</h2><h3 id="下载【注意版本】"><a href="#下载【注意版本】" class="headerlink" title="下载【注意版本】"></a>下载【注意版本】</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">wget http:<span class="string">//ftp.ntu.edu.tw/MySQL/Downloads/MySQL-5.6/mysql-5.6.39-linux-glibc2.12-x86_64.tar.gz</span></span><br><span class="line">wget ftp:<span class="string">//mirror.switch.ch/mirror/mysql/Downloads/MySQL-5.6/mysql-5.6.38.tar.gz</span></span><br><span class="line">wget ftp:<span class="string">//mirror.switch.ch/mirror/mysql/Downloads/MySQL-5.6/mysql-5.6.39.tar.gz</span></span><br><span class="line"></span><br><span class="line">解压到你指定的目录，我这里选择  <span class="string">/usr/local/</span> 目录</span><br><span class="line">tar -zxvf mysql-5.6.39-linux-glibc2.12-x86_64.tar.gz -C <span class="string">/usr/local/</span></span><br><span class="line">mv mysql-5.6.39-linux-glibc2.12-x86_64 mysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">修改权限【我的用户是managers】</span><br><span class="line"></span><br><span class="line">sudo groupadd mysql <span class="comment">#添加组</span></span><br><span class="line"><span class="comment">##sudo useradd -g mysql mysql -s /bin/false #创建用户mysql并加入到mysql组，不允许mysql用户直接</span></span><br><span class="line">sudo chown -R mysql<span class="function">:mysql</span> <span class="string">/usr/local/mysql</span></span><br><span class="line"><span class="keyword">cd</span> mysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">这一步先不要做;</span><br><span class="line">复制文件到init.d下，使机子开机时自动启动mysql服务器。</span><br><span class="line">sudo cp support-files/mysql.server  <span class="string">/etc/init.d/mysql.server</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/mysql/mysql_download.png" alt="mysql download" title="mysql download"></p><h3 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">sudo ./scripts/mysql_install_db <span class="comment">--user=managers</span></span><br><span class="line"></span><br><span class="line">结束后，注意看英文提示</span><br><span class="line"></span><br><span class="line">To <span class="keyword">start</span> mysqld <span class="keyword">at</span> boot <span class="keyword">time</span> you have <span class="keyword">to</span> copy</span><br><span class="line">support-files/mysql.server <span class="keyword">to</span> the <span class="keyword">right</span> place <span class="keyword">for</span> your <span class="keyword">system</span></span><br><span class="line"></span><br><span class="line">PLEASE REMEMBER <span class="keyword">TO</span> <span class="keyword">SET</span> A <span class="keyword">PASSWORD</span> <span class="keyword">FOR</span> THE MySQL root <span class="keyword">USER</span> !</span><br><span class="line"><span class="keyword">To</span> <span class="keyword">do</span> so, <span class="keyword">start</span> the <span class="keyword">server</span>, <span class="keyword">then</span> issue the <span class="keyword">following</span> commands:</span><br><span class="line"></span><br><span class="line">  ./<span class="keyword">bin</span>/mysqladmin -u root <span class="keyword">password</span> <span class="string">'new-password'</span></span><br><span class="line">  ./<span class="keyword">bin</span>/mysqladmin -u root -h ubuntu <span class="keyword">password</span> <span class="string">'new-password'</span></span><br><span class="line"></span><br><span class="line">Alternatively you can run:</span><br><span class="line"></span><br><span class="line">  ./<span class="keyword">bin</span>/mysql_secure_installation</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/mysql/mysql_install.png" alt="mysql install" title="mysql install"></p><h3 id="启动-MySQL-服务"><a href="#启动-MySQL-服务" class="headerlink" title="启动 MySQL 服务"></a>启动 MySQL 服务</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">启动命令：【注意用户，在 managers 用户下】</span><br><span class="line">/usr/<span class="keyword">local</span>/mysql/support-files/mysql.server start</span><br><span class="line"></span><br><span class="line">修改mysql目录下的<span class="keyword">my</span>.cnf配置文件：vi <span class="keyword">my</span>.cnf</span><br><span class="line">找到[mysqld]模块,去掉注释<span class="comment">#，添加如下内容：</span></span><br><span class="line"></span><br><span class="line">basedir=/usr/<span class="keyword">local</span>/mysql</span><br><span class="line">datadir=/usr/<span class="keyword">local</span>/mysql/data</span><br><span class="line">port=<span class="number">3306</span></span><br><span class="line"></span><br><span class="line">这里要是不修改会报错</span><br><span class="line">******************************************************</span><br><span class="line"></span><br><span class="line">错误一：</span><br><span class="line"><span class="keyword">without</span> updating files</span><br><span class="line">或者报错：</span><br><span class="line">Enter password: </span><br><span class="line">ERROR <span class="number">2002</span> (HY000): Can't connect <span class="keyword">to</span> <span class="keyword">local</span> MySQL server <span class="keyword">through</span> socket '/var/<span class="built_in">run</span>/mysqld/mysqld.sock' (<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">修改mysql目录下的<span class="keyword">my</span>.cnf配置文件：vi <span class="keyword">my</span>.cnf</span><br><span class="line">找到[mysqld]模块,去掉注释<span class="comment">#，添加如下内容：</span></span><br><span class="line"></span><br><span class="line">basedir=/usr/<span class="keyword">local</span>/mysql</span><br><span class="line">datadir=/usr/<span class="keyword">local</span>/mysql/data</span><br><span class="line">port=<span class="number">3306</span></span><br><span class="line"></span><br><span class="line">错误二：</span><br><span class="line">Logging <span class="keyword">to</span> '/usr/<span class="keyword">local</span>/mysql/data/ubuntu.err'.</span><br><span class="line">. * The server quit <span class="keyword">without</span> updating PID <span class="built_in">file</span> (/usr/<span class="keyword">local</span>/mysql/data/ubuntu.pid).</span><br><span class="line">解决方法:切换到刚才设置的用户 managers ，然后启动服务：</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/mysql/mysql_start.png" alt="mysql start" title="mysql start"></p><h3 id="查看-MySQL-服务是否启动"><a href="#查看-MySQL-服务是否启动" class="headerlink" title="查看 MySQL 服务是否启动"></a>查看 MySQL 服务是否启动</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo lsof -i:3306</span><br><span class="line"></span><br><span class="line">如图说明启动成功</span><br><span class="line">root@ubuntu:/usr/local/mysql# sudo lsof -i:3306</span><br><span class="line">COMMAND   PID    <span class="built_in"> USER </span>  FD  <span class="built_in"> TYPE </span>DEVICE SIZE/OFF NODE NAME</span><br><span class="line">mysqld  41934 managers   10u <span class="built_in"> IPv6 </span>328086      0t0  TCP *:mysql (LISTEN)</span><br><span class="line">root@ubuntu:/usr/local/mysql#</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/mysql/mysql_check.png" alt="mysql check" title="mysql check"></p><h3 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h3><p>为了能在shell下使用mysql的bin工具（默认mysql 在shell中不能连接），需要将其配置到/etc/profile里。<br>命令如下：   sudo vi /etc/profile<br>在上方添加一行：export MYSQL_HOME=/usr/local/mysql<br>然后在PATH末尾下添加bin目录,添加 \$MYSQL_HOME/bin:$PATH到PATH末尾</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">MYSQL_HOME</span>=/usr/local/mysql</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$MYSQL_HOME</span>/bin:$PATH</span><br></pre></td></tr></table></figure><p>保存后退出，运行如下命令，使环境变量生效：source /etc/profile<br>再在shell下运行如下命令 :export $MYSQL_HOME<br>显示如下：</p><p><img src="/img/ubuntu/mysql/mysql_check.png" alt="mysql check" title="mysql check"></p><h3 id="登录mysql"><a href="#登录mysql" class="headerlink" title="登录mysql"></a>登录mysql</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">使用root账户登录:    mysql -uroot -p</span><br><span class="line">默认密码为空</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/mysql/mysql_login.png" alt="mysql login" title="mysql login"></p><h3 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">password</span> <span class="keyword">for</span>  <span class="string">'root'</span>@<span class="string">'localhost'</span> = <span class="keyword">password</span>(<span class="string">'你的密码'</span>);</span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;  【刷新权限，必须】</span><br></pre></td></tr></table></figure><h3 id="更改-root-账号为所有主机都可以登录"><a href="#更改-root-账号为所有主机都可以登录" class="headerlink" title="更改 root 账号为所有主机都可以登录"></a>更改 root 账号为所有主机都可以登录</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> mysql.user <span class="keyword">set</span>  host=<span class="string">'%'</span> <span class="keyword">where</span> <span class="keyword">user</span>=<span class="string">'root'</span> <span class="keyword">and</span> host=<span class="string">'localhost'</span>;</span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;  【刷新权限，必须】</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/mysql/remote_connection.png" alt="mysql 远程连接" title="mysql 远程连接"></p><h3 id="mysql-命令"><a href="#mysql-命令" class="headerlink" title="mysql 命令"></a>mysql 命令</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/mysql/support-<span class="built_in">files</span>/mysql.server <span class="built_in">start</span></span><br><span class="line">/usr/<span class="built_in">local</span>/mysql/support-<span class="built_in">files</span>/mysql.server <span class="built_in">stop</span></span><br><span class="line"></span><br><span class="line">MySQL登录命令：</span><br><span class="line">mysql -uroot -p</span><br><span class="line"></span><br><span class="line">屏蔽权限</span><br><span class="line">/usr/<span class="built_in">local</span>/mysql/bin/mysqld_safe <span class="comment">--skip-grant-table</span></span><br></pre></td></tr></table></figure><p>set password for  ‘root‘@’localhost’ = password(‘qhdroot!@#’);</p><p>这个命令什么时候执行？？？？？？？</p><p>./bin/mysqladmin -u root -h 127.0.0.1 password ‘qhdroot!@#’</p><hr><p>### </p><p> <a href="http://ftp.ntu.edu.tw/MySQL/Downloads/&quot;mysql官方下载地址&quot;" target="_blank" rel="noopener">mysql官方下载地址</a></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>linux ubuntu16 php7.0.28</title>
      <link href="/2018/03/17/ubuntu/linux_ubuntu_php/"/>
      <url>/2018/03/17/ubuntu/linux_ubuntu_php/</url>
      <content type="html"><![CDATA[<p>源码编译安装php7.0</p><h3 id="依赖安装，安装依赖"><a href="#依赖安装，安装依赖" class="headerlink" title="依赖安装，安装依赖"></a>依赖安装，安装依赖</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">apt-get <span class="keyword">install</span> libxml2 libxml2-dev</span><br><span class="line"></span><br><span class="line">apt-<span class="keyword">get</span> <span class="keyword">install</span> openssl</span><br><span class="line">apt-<span class="keyword">get</span> <span class="keyword">install</span> libssl-dev</span><br><span class="line"></span><br><span class="line">apt-<span class="keyword">get</span> <span class="keyword">install</span> curl</span><br><span class="line">apt-<span class="keyword">get</span> <span class="keyword">install</span> libcurl4-gnutls-dev</span><br><span class="line"></span><br><span class="line">apt-<span class="keyword">get</span> <span class="keyword">install</span> libxslt-dev</span><br><span class="line"></span><br><span class="line">apt-<span class="keyword">get</span> <span class="keyword">install</span> libpng-dev</span><br><span class="line"></span><br><span class="line">apt-<span class="keyword">get</span> <span class="keyword">install</span> libfreetype6-dev</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// RetHat CentOS <span class="keyword">or</span> Fedora 使用下面安装命令</span><br><span class="line">yum <span class="keyword">install</span> curl curl-devel</span><br><span class="line"></span><br><span class="line">****************一般使用的依赖都是以下这些***************************</span><br><span class="line">安装相关依赖库</span><br><span class="line"></span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">update</span></span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> libxml2-dev</span><br><span class="line">#安装gcc</span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> <span class="keyword">build</span>-essential</span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> openssl </span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> libssl-dev </span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> make</span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> curl</span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> libcurl4-gnutls-dev</span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> libjpeg-dev</span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> libpng-dev</span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> libmcrypt-dev</span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> libreadline6 libreadline6-dev</span><br><span class="line">apt-<span class="keyword">get</span> -y <span class="keyword">install</span> libfreetype6-dev  </span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> libxslt1-dev</span><br></pre></td></tr></table></figure><h3 id="下载-PHP-源码"><a href="#下载-PHP-源码" class="headerlink" title="下载 PHP 源码"></a>下载 PHP 源码</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wget http:<span class="comment">//cn2.php.net/get/php-7.0.28.tar.gz/from/this/mirror</span></span><br><span class="line">mv mirror php-<span class="number">7.0</span>.<span class="number">28</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br><span class="line"></span><br><span class="line">解压到你指定的目录，我这里选择  /data/server/ 目录</span><br><span class="line">tar -zxvf php-<span class="number">7.0</span>.<span class="number">28</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span> -C /data/server/</span><br><span class="line">mv php-<span class="number">7.0</span>.<span class="number">28</span> php7</span><br><span class="line">cd php7/</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/php/php7_download.png" alt="PHP7.0.28 下载" title="PHP7.0.28 下载"></p><h3 id="查看安装帮助，执行配置脚本进行编译预处理"><a href="#查看安装帮助，执行配置脚本进行编译预处理" class="headerlink" title="查看安装帮助，执行配置脚本进行编译预处理"></a>查看安装帮助，执行配置脚本进行编译预处理</h3><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"># ./configure   --help</span><br><span class="line"># ./configure --prefix=/data/server/php7 \</span><br><span class="line"> -<span class="ruby">-with-curl \</span></span><br><span class="line"><span class="ruby"> --with-freetype-dir \</span></span><br><span class="line"><span class="ruby"> --with-gd \</span></span><br><span class="line"><span class="ruby"> --with-gettext \</span></span><br><span class="line"><span class="ruby"> --with-iconv-dir \</span></span><br><span class="line"><span class="ruby"> --with-kerberos \</span></span><br><span class="line"><span class="ruby"> --with-libdir=lib64 \</span></span><br><span class="line"><span class="ruby"> --with-libxml-dir \</span></span><br><span class="line"><span class="ruby"> --with-mysqli \</span></span><br><span class="line"><span class="ruby"> --with-openssl \</span></span><br><span class="line"><span class="ruby"> --with-pcre-regex \</span></span><br><span class="line"><span class="ruby"> --with-pdo-mysql \</span></span><br><span class="line"><span class="ruby"> --with-pdo-sqlite \</span></span><br><span class="line"><span class="ruby"> --with-pear \</span></span><br><span class="line"><span class="ruby"> --with-png-dir \</span></span><br><span class="line"><span class="ruby"> --with-xmlrpc \</span></span><br><span class="line"><span class="ruby"> --with-xsl \</span></span><br><span class="line"><span class="ruby"> --with-zlib \</span></span><br><span class="line"><span class="ruby"> --enable-fpm \</span></span><br><span class="line"><span class="ruby"> --enable-bcmath \</span></span><br><span class="line"><span class="ruby"> --enable-libxml \</span></span><br><span class="line"><span class="ruby"> --enable-inline-optimization \</span></span><br><span class="line"><span class="ruby"> --enable-gd-native-ttf \</span></span><br><span class="line"><span class="ruby"> --enable-mbregex \</span></span><br><span class="line"><span class="ruby"> --enable-mbstring \</span></span><br><span class="line"><span class="ruby"> --enable-opcache \</span></span><br><span class="line"><span class="ruby"> --enable-pcntl \</span></span><br><span class="line"><span class="ruby"> --enable-shmop \</span></span><br><span class="line"><span class="ruby"> --enable-soap \</span></span><br><span class="line"><span class="ruby"> --enable-sockets \</span></span><br><span class="line"><span class="ruby"> --enable-sysvsem \</span></span><br><span class="line"><span class="ruby"> --enable-xml \</span></span><br><span class="line"><span class="ruby"> --enable-zip</span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line"><span class="ruby">********************新的编译*****************</span></span><br><span class="line"><span class="ruby">./configure --prefix=<span class="regexp">/data/server</span><span class="regexp">/php7 \</span></span></span><br><span class="line"><span class="ruby">--with-gd \</span></span><br><span class="line"><span class="ruby">--with-freetype-dir \</span></span><br><span class="line"><span class="ruby">--enable-gd-native-ttf \</span></span><br><span class="line"><span class="ruby">--enable-mysqlnd \</span></span><br><span class="line"><span class="ruby">--with-pdo-mysql=mysqlnd \</span></span><br><span class="line"><span class="ruby">--with-openssl \</span></span><br><span class="line"><span class="ruby">--with-mcrypt \</span></span><br><span class="line"><span class="ruby">--enable-mbstring \</span></span><br><span class="line"><span class="ruby">--enable-zip \</span></span><br><span class="line"><span class="ruby">--enable-fpm</span></span><br></pre></td></tr></table></figure><p>我的错误<br>| Configure Command                       | ‘./configure’ ‘–prefix=/data/server/php7’ ‘–with-gd’ ‘–with-freetype-dir’ ‘–enable-gd-native-ttf’ ‘–enable-mysqlnd’ ‘–with-pdo-mysql=mysqlnd’ ‘–with-openssl’ ‘–with-mcrypt’ ‘–enable-mbstring’ ‘–enable-zip’ ‘–enable-fpm’ |<br>| ————————————— | ———————————————————— |<br>| Server API                              | FPM/FastCGI                                                  |<br>| Virtual Directory Support               | disabled                                                     |<br>| Configuration File (php.ini) Path       | /data/server/php7/lib                                        |<br>| Loaded Configuration File               | (none)        【正常情况这里不应该没有值的，还是之前的编译有问题，请仔细查看<br>                     正常应该是这个值   /data/server/php7/lib/php.ini】 |<br>| Scan this dir for additional .ini files | (none)                                                       |<br>| Additional .ini files parsed            | (none)                                                       |<br>|                                         |                                                              |</p><p>之前安装过依赖这里就可以不用装，然后会提示部分依赖没有安装，安装依赖</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">apt-get <span class="keyword">install</span> libxml2 libxml2-dev</span><br><span class="line"></span><br><span class="line">apt-<span class="keyword">get</span> <span class="keyword">install</span> openssl</span><br><span class="line">apt-<span class="keyword">get</span> <span class="keyword">install</span> libssl-dev</span><br><span class="line"></span><br><span class="line">apt-<span class="keyword">get</span> <span class="keyword">install</span> curl</span><br><span class="line">apt-<span class="keyword">get</span> <span class="keyword">install</span> libcurl4-gnutls-dev</span><br><span class="line"></span><br><span class="line">apt-<span class="keyword">get</span> <span class="keyword">install</span> libxslt-dev</span><br><span class="line"></span><br><span class="line">apt-<span class="keyword">get</span> <span class="keyword">install</span> libpng-dev</span><br><span class="line"></span><br><span class="line">apt-<span class="keyword">get</span> <span class="keyword">install</span> libfreetype6-dev</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// RetHat CentOS <span class="keyword">or</span> Fedora 使用下面安装命令</span><br><span class="line">yum <span class="keyword">install</span> curl curl-devel</span><br><span class="line"></span><br><span class="line">****************一般使用的依赖都是以下这些***************************</span><br><span class="line">安装相关依赖库</span><br><span class="line"></span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">update</span></span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> libxml2-dev</span><br><span class="line">#安装gcc</span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> <span class="keyword">build</span>-essential</span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> openssl </span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> libssl-dev </span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> make</span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> curl</span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> libcurl4-gnutls-dev</span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> libjpeg-dev</span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> libpng-dev</span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> libmcrypt-dev</span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> libreadline6 libreadline6-dev</span><br><span class="line">apt-<span class="keyword">get</span> -y <span class="keyword">install</span> libfreetype6-dev  </span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> libxslt1-dev</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/php/php7_configure01.png" alt="php configure" title="php configure"></p><h3 id="预处理ok后，make-编译"><a href="#预处理ok后，make-编译" class="headerlink" title="预处理ok后，make 编译"></a>预处理ok后，make 编译</h3><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">make</span> &amp;&amp;  <span class="built_in">make</span> install</span><br><span class="line"></span><br><span class="line">最后用 <span class="built_in">make</span> test 测试一下【这个过程时间比较长】</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/php/php7_configure01.png" alt="php make" title="php make"></p><p><img src="/img/ubuntu/php/php7_make_install.png" alt="php make install" title="php make install"></p><h3 id="安装完毕"><a href="#安装完毕" class="headerlink" title="安装完毕"></a>安装完毕</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查看 php 版本</span><br><span class="line">/<span class="meta">data</span>/server/php7/<span class="keyword">bin/php </span>-v</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/php/php7_version.png" alt="php version" title="php version"></p><h3 id="配置PHP"><a href="#配置PHP" class="headerlink" title="配置PHP"></a>配置PHP</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">cp <span class="regexp">/data/</span>server<span class="regexp">/php7/</span>php.ini-development   <span class="regexp">/data/</span>server<span class="regexp">/php7/</span>lib/php.ini</span><br><span class="line">cp <span class="regexp">/data/</span>server<span class="regexp">/php7/</span>etc<span class="regexp">/php-fpm.conf.default /</span>data<span class="regexp">/server/</span>php7<span class="regexp">/etc/</span>php-fpm.conf</span><br><span class="line">cp <span class="regexp">/data/</span>server<span class="regexp">/php7/</span>etc<span class="regexp">/php-fpm.d/</span>www.conf.<span class="keyword">default</span> <span class="regexp">/data/</span>server<span class="regexp">/php7/</span>etc<span class="regexp">/php-fpm.d/</span>www.conf</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/php/php7_php_ini.png" alt="php7 php.ini" title="php7 php.ini"></p><h3 id="添加-PHP-启动用户"><a href="#添加-PHP-启动用户" class="headerlink" title="添加 PHP 启动用户"></a>添加 PHP 启动用户</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">设置 PHP 启动用户</span><br><span class="line">cd /data/server/php7/etc/php-fpm.d</span><br><span class="line">vi www.conf  修改23、24行，内容如下：</span><br><span class="line"><span class="built_in"> user </span>= 启动fpm的用户名</span><br><span class="line"><span class="built_in"> group </span>= 启动fpm的用户所在组</span><br><span class="line"> </span><br><span class="line"><span class="built_in"> user </span>= managers</span><br><span class="line"><span class="built_in"> group </span>= managers</span><br><span class="line"></span><br><span class="line">修改完启动 PHP-fpm</span><br></pre></td></tr></table></figure><h3 id="php-启动命令"><a href="#php-启动命令" class="headerlink" title="php 启动命令"></a>php 启动命令</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/data/</span>server<span class="regexp">/php7/</span>sbin<span class="regexp">/php-fpm</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/php/php7_user.png" alt="php7 启动用户" title="php7 启动用户"></p><h3 id="配置虚拟主机测试一下"><a href="#配置虚拟主机测试一下" class="headerlink" title="配置虚拟主机测试一下"></a>配置虚拟主机测试一下</h3><p>在 /data/www/ 目录下创建 index.php 内容如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> phpinfo();</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure><p>在 nginx 中配置虚拟主机</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  <span class="number">127.0.0.1</span> <span class="number">192.168.1.230</span>;</span><br><span class="line">    <span class="attribute">client_max_body_size</span> <span class="number">10m</span>;</span><br><span class="line">    <span class="attribute">charset</span> utf-<span class="number">8</span>;</span><br><span class="line">    <span class="comment">#access_log /data/server/tengine/logs/127.0.0.1_access.log;</span></span><br><span class="line">    <span class="comment">#error_log  /data/server/tengine/logs/127.0.0.1_error.log;</span></span><br><span class="line">    <span class="attribute">root</span>  /data/www/;</span><br><span class="line">   <span class="comment"># index index.html;</span></span><br><span class="line">    <span class="attribute">index</span> index.php;</span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ .+\.php($|/)</span> &#123;</span><br><span class="line">        <span class="attribute">fastcgi_pass</span> <span class="number">127.0.0.1:9000</span>;</span><br><span class="line">        <span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line">        <span class="attribute">include</span> fastcgi.conf;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/php/php7_test.jpg" alt="php7 测试" title="php7 测试"></p><p>扩展： 使用 php -m  查看扩展,提示如下：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root<span class="variable">@ubuntu</span><span class="symbol">:/data/server/php7/bin</span><span class="comment"># php -m</span></span><br><span class="line">The program <span class="string">'php'</span> can be found <span class="keyword">in</span> the following <span class="symbol">packages:</span></span><br><span class="line"> * php7.<span class="number">0</span>-cli</span><br><span class="line"> * hhvm</span><br><span class="line"><span class="symbol">Try:</span> apt install &lt;selected package&gt;</span><br><span class="line">root<span class="variable">@ubuntu</span><span class="symbol">:/data/server/php7/bin</span><span class="comment"># apt install php7.0-cli</span></span><br><span class="line"></span><br><span class="line">安装：  apt install php7.<span class="number">0</span>-cli</span><br></pre></td></tr></table></figure><p>PHP命令</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">php --ini</span><br><span class="line"></span><br><span class="line">查询 PHP 服务 ps aux | <span class="keyword">grep</span> php-fpm</span><br><span class="line">pkill -<span class="number">9</span> php</span><br><span class="line">php启动命令</span><br><span class="line"><span class="regexp">/data/</span>server<span class="regexp">/php7/</span>sbin<span class="regexp">/php-fpm</span></span><br></pre></td></tr></table></figure><p> <a href="http://www.php.net/downloads.php&quot;PHP官网下载地址&quot;" target="_blank" rel="noopener">PHP官网下载地址</a></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>win server 2008 部署php</title>
      <link href="/2018/03/15/win/win_server_2008_IIS/"/>
      <url>/2018/03/15/win/win_server_2008_IIS/</url>
      <content type="html"><![CDATA[<h3 id="配置IIS-（安装好-PHPstudy-后测试php）"><a href="#配置IIS-（安装好-PHPstudy-后测试php）" class="headerlink" title="配置IIS （安装好 PHPstudy 后测试php）"></a>配置IIS （安装好 PHPstudy 后测试php）</h3><p>在计算机右击,选择管理，出现服务器管理界面；或者打开“开始”菜单→“服务器管理”，出现服务器管理界面</p><p><img src="/img/win_server2008/IIS_01.png" alt="IIS"></p><p>添加角色，下一步，选择 web 服务器（IIS）,下一步 选择 CGI,一直下一步</p><p><img src="/img/win_server2008/IIS_02.png" alt="IIS"></p><p><img src="/img/win_server2008/IIS_03.png" alt="IIS"></p><p><img src="/img/win_server2008/IIS_04.png" alt="IIS"></p><p>安装好IIS后，需要测试一下，在浏览器中输入 localhost ，如果出现 IIS7 欢迎界面说明正常；</p><p><img src="/img/win_server2008/IIS_05.png" alt="IIS"></p><p>配置一个新网站，打开 IIS 管理器（“开始”→“所有程序”→“管理工具”→“internet 信息服务（IIS）管理器”）；<br>备注：使用 PHPstudy 打开 IIS 管理器，需要提前安装好 PHPstudy；</p><p><img src="/img/win_server2008/IIS_06.png" alt="IIS"></p><p><img src="/img/win_server2008/IIS_07.png" alt="IIS"></p><p>添加好后，在 IIS 管理器中，在刚才添加的网站 “网站名称” 上右键，点击 “编辑权限” ，进入后点击“安全”选项卡，再点击其中的“编辑” 。打开“编辑”窗口后点击“添加”按钮。添加一个“用户”到权限用户列表中，然后为其勾选除了“完全控制”之外的权限。然后点击“确定” “应用”。</p><p><img src="/img/win_server2008/IIS_08.png" alt="IIS"></p><p>结束后，在刚才选择的物理路径下创建 index.html ,然后用记事本打开，输入 ”hello world“ 测试；</p><p>如果是做 PHP 开发，安装好 PHPstudy 后，可出在刚才选择的物理路径下创建 index.php ,然后用记事本打开，输入 如下做测试</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> phpinfo();</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure><p><img src="/img/win_server2008/IIS_09.png" alt="IIS"></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>linux ubuntu lnmp环境</title>
      <link href="/2018/03/13/ubuntu/linux_ubuntu_lnmp/"/>
      <url>/2018/03/13/ubuntu/linux_ubuntu_lnmp/</url>
      <content type="html"><![CDATA[<h3 id="LNMP环境搭建"><a href="#LNMP环境搭建" class="headerlink" title="LNMP环境搭建"></a>LNMP环境搭建</h3><p>使用命令下载 nginx 安装包</p><p><img src="/img/ubuntu/linux_command/linux_00/root_passwd.png" alt="root passwd"></p><p> <a href="http://nginx.org/" title="nginx官网" target="_blank" rel="noopener">nginx官网</a><br> <a href="http://nginx.org/" title="nginx官网" target="_blank" rel="noopener">nginx官网</a><br> <a href="http://nginx.org/" title="nginx官网" target="_blank" rel="noopener">nginx官网</a></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>linux ubuntu shipyard</title>
      <link href="/2018/03/09/ubuntu/linux_ubuntu_shipyard/"/>
      <url>/2018/03/09/ubuntu/linux_ubuntu_shipyard/</url>
      <content type="html"><![CDATA[<h3 id="Shipyard简介"><a href="#Shipyard简介" class="headerlink" title="Shipyard简介"></a>Shipyard简介</h3><p>待完善。。。。。。。</p><p>Shipyard 是一个基于 Web 的 Docker 管理工具，支持多 host，可以把多个 Docker host 上的 containers 统一管理；可以查看 images，甚至 build images；并提供 RESTful API 等</p><h3 id="安装-shipyard"><a href="#安装-shipyard" class="headerlink" title="安装 shipyard"></a>安装 shipyard</h3><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span> --<span class="keyword">rm</span> -v /<span class="keyword">var</span>/<span class="keyword">run</span>/docker.sock:/<span class="keyword">var</span>/<span class="keyword">run</span>/docker.sock shipyard/deploy start</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/shipyard/shipyard_install.png" alt="root passwd"></p><p> <a href="http://shipyard-project.com/&quot;shipyard官网 最近官网不能访问&quot;" target="_blank" rel="noopener">Shipyard官网最近官网不能访问</a></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>linux DDU scp</title>
      <link href="/2018/03/08/ubuntu/linux_DDU_scp/"/>
      <url>/2018/03/08/ubuntu/linux_DDU_scp/</url>
      <content type="html"><![CDATA[<h3 id="scp-简介"><a href="#scp-简介" class="headerlink" title="scp 简介"></a>scp 简介</h3><p>scp是secure copy的简写，用于在Linux下进行远程拷贝文件的命令，和它类似的命令有cp，<font color="red">不过cp只是在本机进行拷贝不能跨服务器</font>，而且scp传输是加密的。可能会稍微影响一下速度。当你服务器硬盘变为只读 read only system时，用scp可以帮你把文件移出来。另外，scp还非常不占资源，不会提高多少系统负荷，在这一点上，rsync就远远不及它了。虽然 rsync比scp会快一点，但当小文件众多的情况下，rsync会导致硬盘I/O非常高，而scp基本不影响系统正常使用</p><h3 id="命令格式"><a href="#命令格式" class="headerlink" title="命令格式"></a>命令格式</h3><p>scp [参数]  [原路径]  [目标路径]</p><h3 id="命令参数"><a href="#命令参数" class="headerlink" title="命令参数"></a>命令参数</h3><p>-1 强制scp命令使用协议ssh1<br>-2 强制scp命令使用协议ssh2<br>-4 强制scp命令只使用IPv4寻址<br>-6 强制scp命令只使用IPv6寻址<br>-B 使用批处理模式（传输过程中不询问传输口令或短语）<br>-C 允许压缩。（将-C标志传递给ssh，从而打开压缩功能）<br>-p 保留原文件的修改时间，访问时间和访问权限。<br>-q 不显示传输进度条。<br>-r 递归复制整个目录。<br>-v 详细方式显示输出。scp和ssh(1)会显示出整个过程的调试信息。这些信息用于调试连接，验证和配置问题。<br>-c cipher 以cipher将数据传输进行加密，这个选项将直接传递给ssh。<br>-F ssh_config 指定一个替代的ssh配置文件，此参数直接传递给ssh。<br>-i identity_file 从指定文件中读取传输时使用的密钥文件，此参数直接传递给ssh。<br>-l limit 限定用户所能使用的带宽，以Kbit/s为单位。<br>-o ssh_option 如果习惯于使用ssh_config(5)中的参数传递方式，<br>-P port 注意是大写的P, port是指定数据传输用到的端口号<br>-S program 指定加密传输时所使用的程序。此程序必须能够理解ssh(1)的选项</p><h3 id="使用实例"><a href="#使用实例" class="headerlink" title="使用实例"></a>使用实例</h3><p>使用scp前提：两台服务器必须都安装 ssh</p><h4 id="从本地服务器复制到远程服务器"><a href="#从本地服务器复制到远程服务器" class="headerlink" title="从本地服务器复制到远程服务器"></a>从本地服务器复制到远程服务器</h4><h4 id="复制文件"><a href="#复制文件" class="headerlink" title="复制文件"></a>复制文件</h4><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">注意目标文件的权限<span class="symbol">:</span></span><br><span class="line">scp local_file remote_username<span class="variable">@remote_ip</span><span class="symbol">:remote_folder</span></span><br><span class="line">或者</span><br><span class="line">scp local_file remote_username<span class="variable">@remote_ip</span><span class="symbol">:remote_file</span></span><br><span class="line">或者</span><br><span class="line">scp local_file <span class="symbol">remote_ip:</span>remote_folder</span><br><span class="line">或者</span><br><span class="line">scp local_file <span class="symbol">remote_ip:</span>remote_file</span><br><span class="line"></span><br><span class="line">demo：</span><br><span class="line">scp test2_01.test dafei<span class="variable">@192</span>.<span class="number">168.1</span>.<span class="number">113</span><span class="symbol">:/data/www/test/</span></span><br></pre></td></tr></table></figure><p>第1,2个指定了用户名，命令执行后需要输入用户密码，<br>第1个仅指定了远程的目录，文件名字不变，<br>第2个指定了文件名<br>第3,4个没有指定用户名，命令执行后需要输入用户名和密码（默认使用root），<br>第3个仅指定了远程的目录，文件名字不变，<br>第4个指定了文件名</p><p><img src="/img/ubuntu/linux_command/linux_scp/scp_local_remote01.png" alt="scp 本地拷贝到远程复制文件" title="本地拷贝到远程复制文件"></p><h4 id="复制目录"><a href="#复制目录" class="headerlink" title="复制目录"></a>复制目录</h4><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-r参数不要遗漏：【否则报错： <span class="keyword">not</span> a regular file】</span><br><span class="line">scp -r local_folder remote_username<span class="variable">@remote_ip</span><span class="symbol">:remote_folder</span></span><br><span class="line">或者</span><br><span class="line">scp -r local_folder <span class="symbol">remote_ip:</span>remote_folder </span><br><span class="line"></span><br><span class="line"><span class="symbol">demo:</span></span><br><span class="line">scp -r test2 dafei<span class="variable">@192</span>.<span class="number">168.1</span>.<span class="number">113</span><span class="symbol">:/data/www/test/</span></span><br></pre></td></tr></table></figure><p>第1个指定了用户名，命令执行后需要输入用户密码；<br>第2个没有指定用户名，命令执行后需要输入用户名和密码(默认使用root)；</p><p><img src="/img/ubuntu/linux_command/linux_scp/scp_local_remote02.png" alt="scp 本地拷贝到远程复制目录" title="scp 本地拷贝到远程复制目录"></p><h4 id="从远程服务器复制到本地服务器"><a href="#从远程服务器复制到本地服务器" class="headerlink" title="从远程服务器复制到本地服务器"></a>从远程服务器复制到本地服务器</h4><p>从远程复制到本地的scp命令与上面的命令雷同，只要将从本地复制到远程的命令后面2个参数互换顺序就行了</p><p>从远程拷贝文件到本地目录</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scp root<span class="variable">@remote_ip</span><span class="symbol">:remote_file</span> local_folder</span><br><span class="line">demo：</span><br><span class="line">scp dafei<span class="variable">@192</span>.<span class="number">168.1</span>.<span class="number">87</span><span class="symbol">:/data/www/test2/test2_01</span>.test  /data/www/test/</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/linux_command/linux_scp/scp_remote_locat01.png" alt="scp 远程拷贝文件到本地" title="scp 远程拷贝文件到本地"></p><h4 id="从远处复制目录到本地"><a href="#从远处复制目录到本地" class="headerlink" title="从远处复制目录到本地"></a>从远处复制目录到本地</h4><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scp -r root<span class="variable">@remote_ip</span><span class="symbol">:remote_folder</span> local_folder</span><br><span class="line"><span class="symbol">demo:</span></span><br><span class="line">scp -r dafei<span class="variable">@192</span>.<span class="number">168.1</span>.<span class="number">87</span><span class="symbol">:/data/www/test2</span> /data/www/test/</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/linux_command/linux_scp/scp_remote_locat02.png" alt="scp 远程拷贝目录到本地" title="scp 远程拷贝目录到本地"></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>linux ubuntu tomact</title>
      <link href="/2018/03/01/ubuntu/linux_ubuntu_tomact/"/>
      <url>/2018/03/01/ubuntu/linux_ubuntu_tomact/</url>
      <content type="html"><![CDATA[<h4 id="官网下载-Tomact-包上传到服务器"><a href="#官网下载-Tomact-包上传到服务器" class="headerlink" title="官网下载 Tomact 包上传到服务器"></a>官网下载 Tomact 包上传到服务器</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">然后解压：</span><br><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">tar</span> <span class="selector-tag">-zxvf</span> <span class="selector-tag">apache-tomcat-9</span><span class="selector-class">.0</span><span class="selector-class">.5</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/tomact/tomcat_tar.png" alt="tomact 解压" title="tomact 解压"></p><p>在 /data/server 目录创建 tomcat 目录；然后将文件夹 apache-tomcat-9.0.5 移动到   /data/server/tomcat 下：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir tomcat</span><br><span class="line">sudo mv  apache-tomcat-<span class="number">9.0</span>.<span class="number">5</span> <span class="regexp">/data/</span>server<span class="regexp">/tomcat/</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/tomact/tomcat_position.png" alt="tomact 位置" title="tomact 位置"></p><h4 id="进入-data-server-tomcat-apache-tomcat-9-0-5-bin，编辑-startup-sh"><a href="#进入-data-server-tomcat-apache-tomcat-9-0-5-bin，编辑-startup-sh" class="headerlink" title="进入/data/server/tomcat/apache-tomcat-9.0.5/bin，编辑 startup.sh"></a>进入/data/server/tomcat/apache-tomcat-9.0.5/bin，编辑 startup.sh</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">在最后一行加入下信息;</span><br><span class="line"></span><br><span class="line"><span class="comment">#set java environment</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">JAVA_HOME</span>=/usr/lib/jvm/jdk1.8.0_161    ## 这里要注意要换成自己解压的 jdk 目录</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">JRE_HOME</span>=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">CLASSPATH</span>=.:%&#123;JAVA_HOME&#125;/lib:%&#123;JRE_HOME&#125;/lib</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:$PATH</span><br><span class="line"></span><br><span class="line"><span class="comment">#tomcat</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">TOMCAT_HOME</span>=/data/server/tomcat/apache-tomcat-9.0.5  ## 这里要注意要换成自己解压的 tomcat 目录</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/tomact/tomcat_environment.png" alt="tomact 环境变量" title="tomact 环境变量"></p><h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="string">./startup.sh</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/tomact/tomcat_start.png" alt="tomact 启动成功" title="tomact 启动成功"></p><h4 id="关闭-tomcat-，需要在-shutdown-sh-对应的位置添加信息"><a href="#关闭-tomcat-，需要在-shutdown-sh-对应的位置添加信息" class="headerlink" title="关闭 tomcat ，需要在 shutdown.sh 对应的位置添加信息"></a>关闭 tomcat ，需要在 shutdown.sh 对应的位置添加信息</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">在最后一行加入下信息;</span><br><span class="line"></span><br><span class="line"><span class="comment">#set java environment</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">JAVA_HOME</span>=/usr/lib/jvm/jdk1.8.0_161      ## 这里要注意要换成自己解压的 jdk 目录</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">JRE_HOME</span>=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">CLASSPATH</span>=.:%&#123;JAVA_HOME&#125;/lib:%&#123;JRE_HOME&#125;/lib</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:$PATH</span><br><span class="line"></span><br><span class="line"><span class="comment">#tomcat</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">TOMCAT_HOME</span>=/data/server/tomcat/apache-tomcat-9.0.5  ## 这里要注意要换成自己解压的 tomcat 目录</span><br></pre></td></tr></table></figure><h4 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h4><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./<span class="built_in">shutdown</span>.sh</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/tomact/tomcat_stop.png" alt="tomact 停止" title="tomact 停止"></p><h4 id="加入开机启动："><a href="#加入开机启动：" class="headerlink" title="加入开机启动："></a>加入开机启动：</h4><h4 id="把catalina-sh文件复制到-etc-init-d"><a href="#把catalina-sh文件复制到-etc-init-d" class="headerlink" title="把catalina.sh文件复制到/etc/init.d"></a>把catalina.sh文件复制到/etc/init.d</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">sudo cp -p /data/server/tomcat/apache-tomcat-9.0.5/bin/catalina.sh /etc/init.d/tomcat  </span><br><span class="line"></span><br><span class="line">编辑tomcat文件： </span><br><span class="line">sudo vim /etc/init.d/tomcat </span><br><span class="line"></span><br><span class="line">在开头写如下内容：【提醒：这里一定要注意书写格式，不能有空格，有#的注释部分也要写全，不要遗漏】</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## BEGIN INIT INFO  </span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Provides:          tomcat  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Required-Start:    <span class="variable">$local_fs</span> <span class="variable">$network</span>  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Required-Stop:     <span class="variable">$local_fs</span>  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Default-Start:     2 3 4 5  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Default-Stop:      0 1 6  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Short-Description: tomcat service  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Description:       tomcat service daemon  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## END INIT INFO  </span></span></span><br><span class="line">CATALINA_HOME=/data/server/tomcat/apache-tomcat-9.0.5  </span><br><span class="line">JAVA_HOME=/usr/lib/jvm/jdk1.8.0_161</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/tomact/tomcat_edit_content.png" alt="tomact 开机自启编辑内容" title="tomact 开机自启编辑内容"></p><h4 id="添加自启动服务"><a href="#添加自启动服务" class="headerlink" title="添加自启动服务"></a>添加自启动服务</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span>-rc.d tomcat <span class="keyword">defaults</span></span><br></pre></td></tr></table></figure><h4 id="测试，关机重启访问-localhost-8080-或者-192-168-1-113-8080"><a href="#测试，关机重启访问-localhost-8080-或者-192-168-1-113-8080" class="headerlink" title="测试，关机重启访问 localhost:8080  或者 192.168.1.113:8080"></a>测试，关机重启访问 localhost:8080  或者 192.168.1.113:8080</h4><p><img src="/img/ubuntu/tomact/tomcat_start2.png" alt="tomact 开机自启成功" title="tomact 开机自启成功"></p><h4 id="tomact-命令"><a href="#tomact-命令" class="headerlink" title="tomact 命令"></a>tomact 命令</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">service tomcat &#123;start|stop|restart&#125;</span><br><span class="line">service tomcat stop</span><br><span class="line">service tomcat start</span><br><span class="line">service tomcat restart</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>linux Ubuntu jdk</title>
      <link href="/2018/02/28/ubuntu/linux_ubuntu_jdk/"/>
      <url>/2018/02/28/ubuntu/linux_ubuntu_jdk/</url>
      <content type="html"><![CDATA[<h2 id="Ubuntu-安装-jdk-2-种方式"><a href="#Ubuntu-安装-jdk-2-种方式" class="headerlink" title="Ubuntu 安装 jdk 2 种方式"></a>Ubuntu 安装 jdk 2 种方式</h2><p>1、 通过 ppa 源方式安装 jdk8<br>2、通过官网下载安装包安装 jdk8</p><p>检测linux多少位： getconf LONG_BIT    我的系统是64位</p><h2 id="使用-ppa-源方式安装"><a href="#使用-ppa-源方式安装" class="headerlink" title="使用 ppa 源方式安装"></a>使用 ppa 源方式安装</h2><h3 id="添加ppa"><a href="#添加ppa" class="headerlink" title="添加ppa"></a>添加ppa</h3><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo<span class="built_in"> add-apt-repository </span>ppa:webupd8team/java</span><br><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure><h3 id="安装oracle-java-installer"><a href="#安装oracle-java-installer" class="headerlink" title="安装oracle-java-installer"></a>安装oracle-java-installer</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="builtin-name">get</span> install oracle-java8-installer</span><br></pre></td></tr></table></figure><p>接下来会出现连个界面，选择ok、yes 即可</p><p><img src="/img/ubuntu/jdk/installer.png" alt="jdk1.8 install" title="jdk1.8 install"></p><p><img src="/img/ubuntu/jdk/installer.png" alt="jdk1.8 install" title="jdk1.8 install02"></p><h4 id="查看java版本"><a href="#查看java版本" class="headerlink" title="查看java版本"></a>查看java版本</h4><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -<span class="built_in">version</span></span><br></pre></td></tr></table></figure><h3 id="卸载jdk"><a href="#卸载jdk" class="headerlink" title="卸载jdk"></a>卸载jdk</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="builtin-name">get</span> <span class="builtin-name">remove</span> openjdk*</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/jdk/uninstall.png" alt="uninstall" title="uninstall"></p><h3 id="直接下载-jdk-压缩包方式安装"><a href="#直接下载-jdk-压缩包方式安装" class="headerlink" title="直接下载 jdk 压缩包方式安装"></a>直接下载 jdk 压缩包方式安装</h3><h4 id="官网下载-jdk"><a href="#官网下载-jdk" class="headerlink" title="官网下载 jdk"></a>官网下载 jdk</h4><p><a href="http://www.oracle.com/technetwork/java/javase/downloads/java-archive-javase8-2177648.html" title="jdk1.8 官网地址" target="_blank" rel="noopener">jdk1.8 官网地址</a>    选择相应的系统 .tar.gz 包，然后用ssh上传到服务器【提醒：不要在服务器直接下载，否则解压会出错】</p><p><img src="/img/ubuntu/jdk/tar_download_error.png" alt="tar Download error" title="tar Download error"></p><h4 id="解压缩，放到指定目录"><a href="#解压缩，放到指定目录" class="headerlink" title="解压缩，放到指定目录"></a>解压缩，放到指定目录</h4><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -zxvf jdk-<span class="number">8</span>u161-linux-x64.tar.gz -C /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">jvm</span></span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/jdk/tar_jdk.png" alt="tar jdk" title="tar jdk"></p><h4 id="修改环境变量"><a href="#修改环境变量" class="headerlink" title="修改环境变量"></a>修改环境变量</h4><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim ~<span class="string">/.bashrc</span></span><br></pre></td></tr></table></figure><p>文件的末尾追加下面内容</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#set oracle jdk environment</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">JAVA_HOME</span>=/usr/lib/jvm/jdk1.8.0_161  ## 这里要注意目录要换成自己解压的jdk 目录</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">JRE_HOME</span>=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre  </span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">CLASSPATH</span>=.:$&#123;JAVA_HOME&#125;/lib:<span class="variable">$&#123;JRE_HOME&#125;</span>/lib  </span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:$PATH</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/jdk/jdk_environment.png" alt="jdk environment" title="jdk environment"></p><h4 id="设置系统默认-jdk-版本"><a href="#设置系统默认-jdk-版本" class="headerlink" title="设置系统默认 jdk 版本"></a>设置系统默认 jdk 版本</h4><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --install /usr/bin/java java /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">jvm</span>/<span class="title">jdk1</span>.8.0<span class="title">_161</span>/<span class="title">bin</span>/<span class="title">java</span> 300  </span></span><br><span class="line">sudo update-alternatives --install /usr/bin/javac javac /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">jvm</span>/<span class="title">jdk1</span>.8.0<span class="title">_161</span>/<span class="title">bin</span>/<span class="title">javac</span> 300  </span></span><br><span class="line">sudo update-alternatives --install /usr/bin/jar jar /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">jvm</span>/<span class="title">jdk1</span>.8.0<span class="title">_161</span>/<span class="title">bin</span>/<span class="title">jar</span> 300   </span></span><br><span class="line">sudo update-alternatives --install /usr/bin/javah javah /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">jvm</span>/<span class="title">jdk1</span>.8.0<span class="title">_161</span>/<span class="title">bin</span>/<span class="title">javah</span> 300   </span></span><br><span class="line">sudo update-alternatives --install /usr/bin/javap javap /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">jvm</span>/<span class="title">jdk1</span>.8.0<span class="title">_161</span>/<span class="title">bin</span>/<span class="title">javap</span> 300  </span></span><br><span class="line"></span><br><span class="line">然后执行</span><br><span class="line">sudo update-alternatives --config java</span><br></pre></td></tr></table></figure><h4 id="测试-jdk"><a href="#测试-jdk" class="headerlink" title="测试 jdk"></a>测试 jdk</h4><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -<span class="built_in">version</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/jdk/java_version.png" alt="java version" title="java version"></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>linux Ubuntu nginx</title>
      <link href="/2018/02/26/ubuntu/linux_ubuntu_nginx/"/>
      <url>/2018/02/26/ubuntu/linux_ubuntu_nginx/</url>
      <content type="html"><![CDATA[<h3 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="builtin-name">get</span> install nginx</span><br><span class="line"></span><br><span class="line">启动 ngnnx:  </span><br><span class="line">sudo<span class="built_in"> service </span>nginx start</span><br><span class="line"></span><br><span class="line">扩展centos nginx 重启</span><br><span class="line">service nginx restart</span><br><span class="line">/etc/init.d/nginx stop</span><br><span class="line">/etc/init.d/nginx start</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/nginx/nginx_start.png" alt="ubuntu nginx start" title="ubuntu nginx start"></p><h3 id="查看nginx配置文件目录"><a href="#查看nginx配置文件目录" class="headerlink" title="查看nginx配置文件目录"></a>查看nginx配置文件目录</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ps</span> -aux | <span class="keyword">grep</span> nginx   【返回结果包含安装目录】</span><br><span class="line">nginx -t               【返回结果包含配置文件目录】</span><br><span class="line"><span class="keyword">cat</span> /etc/nginx/nginx.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure><p> <img src="/img/ubuntu/nginx/nginx_server.png" alt="nginx 安装位置" title="nginx 安装位置"></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>linux ubuntu jenkins</title>
      <link href="/2018/02/17/ubuntu/linux_ubuntu_jenkins/"/>
      <url>/2018/02/17/ubuntu/linux_ubuntu_jenkins/</url>
      <content type="html"><![CDATA[<h3 id="下载war-包"><a href="#下载war-包" class="headerlink" title="下载war 包"></a>下载war 包</h3><h4 id="第一种安装方式："><a href="#第一种安装方式：" class="headerlink" title="第一种安装方式："></a>第一种安装方式：</h4><p>前提：系统中必须安装好jdk，我的 jdk 是1.8</p><p>将下载好的war包放到linux中；切换到 jenkins.war　存放目录，输入命令： java -jar jenkins.war　<br>然后在浏览器中输入localhost:8080,就可以打开Jenkins</p><p><img src="/img/ubuntu/jenkins/01_install01" alt="Jenkins 安装" title="Jenkins 安装"></p><p><img src="/img/ubuntu/jenkins/01_install02" alt="Jenkins 安装" title="Jenkins 安装"></p><p>这种方式安装好后命令窗口会一直保持打开状态，不太实用；</p><h4 id="第二种安装方式，在-tomcat-中启动"><a href="#第二种安装方式，在-tomcat-中启动" class="headerlink" title="第二种安装方式，在 tomcat 中启动"></a>第二种安装方式，在 tomcat 中启动</h4><p><img src="/img/ubuntu/jenkins/01.png" alt="Jenkins war包" title="Jenkins war包"></p><p><img src="/img/ubuntu/jenkins/02.png" alt="Jenkins" title="Jenkins"></p><p><img src="/img/ubuntu/jenkins/03.png" alt="Jenkins" title="Jenkins"></p><p><img src="/img/ubuntu/jenkins/04.png" alt="Jenkins" title="Jenkins"></p><p><img src="/img/ubuntu/jenkins/05.png" alt="Jenkins" title="Jenkins"></p><p><img src="/img/ubuntu/jenkins/windows.png" alt="Jenkins" title="Jenkins"></p><p>不管用那种方法，安装后登录时空白，现在没有时间弄了，有知道的请留言</p><p><img src="/img/ubuntu/jenkins/06_error.png" alt="Jenkins error" title="Jenkins error"></p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">wget -q -O - http<span class="variable">s:</span>//pkg.jenkins.io/debian/jenkins-ci.org.key | sudo apt-key <span class="built_in">add</span> -</span><br><span class="line">sudo <span class="keyword">sh</span> -<span class="keyword">c</span> <span class="string">'echo deb http://pkg.jenkins.io/debian-stable binary/ &gt; /etc/apt/sources.list.d/jenkins.list'</span></span><br><span class="line">sudo apt-<span class="built_in">get</span> <span class="keyword">update</span></span><br><span class="line">sudo apt-<span class="built_in">get</span> install jenkins</span><br><span class="line"></span><br><span class="line">如果是升级，直接使用一下命令</span><br><span class="line">sudo apt-<span class="built_in">get</span> <span class="keyword">update</span></span><br><span class="line">sudo apt-<span class="built_in">get</span> install jenkins</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/jenkins/jenkins_user.png" alt="jenkins 用户" title="Jenkins 用户"></p><h3 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h3><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//服务</span></span><br><span class="line">sudo apt-<span class="built_in">get</span> <span class="built_in">remove</span> jenkins</span><br><span class="line"></span><br><span class="line"><span class="comment">//安装包，注意这里如果不是ubuntu那就yum</span></span><br><span class="line">sudo apt-<span class="built_in">get</span> <span class="built_in">remove</span> --<span class="keyword">auto</span>-<span class="built_in">remove</span> jenkins</span><br><span class="line"></span><br><span class="line"><span class="comment">//配置和数据</span></span><br><span class="line">sudo apt-<span class="built_in">get</span> purge jenkins</span><br><span class="line"></span><br><span class="line">sudo apt-<span class="built_in">get</span> purge --<span class="keyword">auto</span>-<span class="built_in">remove</span> jenkins</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>linux Ubuntu git</title>
      <link href="/2018/02/13/ubuntu/linux_ubuntu_git/"/>
      <url>/2018/02/13/ubuntu/linux_ubuntu_git/</url>
      <content type="html"><![CDATA[<h3 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h3><p>本地:  windows7   ip: 192.168.1.105<br>服务器Ubuntu ： Ubuntu 15.10     ip: 192.168.1.113  【cat /etc/issue】 </p><h3 id="Ubuntu中git安装"><a href="#Ubuntu中git安装" class="headerlink" title="Ubuntu中git安装"></a>Ubuntu中git安装</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="comment">--version  【检测当前环境是否安装git】</span></span><br><span class="line"></span><br><span class="line">sudo apt-<span class="keyword">get</span> install git  【安装git】</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/git/git_install.png" alt="git install" title="git install"></p><h3 id="新增用户"><a href="#新增用户" class="headerlink" title="新增用户"></a>新增用户</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">新增用户(用户名为git_dafei),用于运行git服务，回车后输入密码</span><br><span class="line"><span class="keyword">adduser </span>git_dafei</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/git/git_adduser.png" alt="git adduser" title="git adduser"></p><h3 id="初始git仓库，"><a href="#初始git仓库，" class="headerlink" title="初始git仓库，"></a>初始git仓库，</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">我在 /home/git_dafei/<span class="selector-tag">code</span> ( mkdir -<span class="selector-tag">p</span> /home/git_dafei/<span class="selector-tag">code</span> 注意创建这个目录后的所有者，权限)</span><br><span class="line">这个目录下，使用 git init 这个--bare 选项为它设置一个空的存储库，</span><br><span class="line">一般服务器上的 Git 仓库是以 <span class="selector-class">.git</span> 结尾的空仓库</span><br><span class="line"></span><br><span class="line">git init --bare test.git</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/git/git_init.png" alt="git init" title="git init"></p><p><img src="/img/ubuntu/git/git_init02.png" alt="git init02" title="git init02"></p><p>开始本地(windows)操作</p><h3 id="本地生成公钥-位置-C-Users-Administrator-ssh-或者-ssh"><a href="#本地生成公钥-位置-C-Users-Administrator-ssh-或者-ssh" class="headerlink" title="本地生成公钥,位置  C:\Users\Administrator\.ssh 或者  ~/.ssh"></a>本地生成公钥,位置  C:\Users\Administrator\.ssh 或者  ~/.ssh</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa <span class="keyword">ls</span> ~<span class="string">/.ssh/</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/git/git_win_ssh.png" alt="git win ssh" title="git win ssh"></p><h3 id="将win用户的公钥-即-id-rsa-pub-添加到服务器上"><a href="#将win用户的公钥-即-id-rsa-pub-添加到服务器上" class="headerlink" title="将win用户的公钥(即 id_rsa.pub )添加到服务器上"></a>将win用户的公钥(即 id_rsa.pub )添加到服务器上</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> scp ~<span class="regexp">/.ssh/id</span>_rsa.pub git_dafei<span class="variable">@192</span>.<span class="number">168.1</span>.<span class="number">113</span><span class="symbol">:/home/git_dafei/</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">[扩展<span class="symbol">:</span>使用ssh端口 ] scp -P <span class="number">22</span> ~<span class="regexp">/.ssh/id</span>_rsa.pub git_dafei<span class="variable">@192</span>.<span class="number">168.1</span>.<span class="number">113</span><span class="symbol">:/home/git_dafei/</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/git/git_win_scp.png" alt="git win scp" title="git win scp"></p><h3 id="将本地用户的公钥添加到认证文件中"><a href="#将本地用户的公钥添加到认证文件中" class="headerlink" title="将本地用户的公钥添加到认证文件中"></a>将本地用户的公钥添加到认证文件中</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> <span class="string">/home/git_dafei</span></span><br><span class="line">mkdir <span class="string">.ssh</span></span><br><span class="line">touch authorized_keys    【在 <span class="string">.ssh</span>中创建 】</span><br><span class="line">cat id_rsa.pub &gt;&gt; <span class="string">.ssh/authorized_keys</span>   [如果没有 authorized_keys 请创建 touch authorized_keys</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/git/git_ssh.png" alt="git ssh" title="git ssh"></p><p><img src="/img/ubuntu/git/git_id_rs.png" alt="git id_rs" title="git id_rs"></p><h3 id="修改文件所有者为-git-dafei-用户"><a href="#修改文件所有者为-git-dafei-用户" class="headerlink" title="修改文件所有者为 git_dafei 用户"></a>修改文件所有者为 git_dafei 用户</h3><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">chown -R git_dafei:git_dafei /home/git_dafei</span><br><span class="line"></span><br><span class="line">chmod<span class="number"> 755 </span>/home/git_dafei/                       <span class="comment"># 1. 用户git_dafei目录755权限</span></span><br><span class="line">chmod<span class="number"> 700 </span>/home/git_dafei/.ssh                   <span class="comment"># 2. .ssh目录700权限</span></span><br><span class="line">chmod<span class="number"> 600 </span>/home/git_dafei/.ssh/authorized_keys   <span class="comment"># 3. authorized_keys 600权限 </span></span><br><span class="line"></span><br><span class="line">////////////////////效果//////////////////////////</span><br><span class="line">drwxr-xr-x<span class="number"> 2 </span>git_dafei git_dafei<span class="number"> 4096 </span>Feb<span class="number"> 14 </span>19:39 .ssh  【修改前权限】</span><br><span class="line">chmod<span class="number"> 700 </span>/home/git_dafei/.ssh</span><br><span class="line">drwx------<span class="number"> 2 </span>git_dafei git_dafei<span class="number"> 4096 </span>Feb<span class="number"> 14 </span>19:39 .ssh  【修改后权限】</span><br><span class="line"></span><br><span class="line">【修改前权限】：</span><br><span class="line">-rw-r--r--<span class="number"> 1 </span>git_dafei git_dafei<span class="number"> 401 </span>Feb<span class="number"> 14 </span>19:40 /home/git_dafei/.ssh/authorized_keys </span><br><span class="line"></span><br><span class="line">chmod<span class="number"> 600 </span>/home/git_dafei/.ssh/authorized_keys</span><br><span class="line"></span><br><span class="line">【修改后权限】</span><br><span class="line">-rw-------<span class="number"> 1 </span>git_dafei git_dafei<span class="number"> 401 </span>Feb<span class="number"> 14 </span>19:40 /home/git_dafei/.ssh/authorized_keys</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/git/git_chmod.png" alt="git chmod" title="git chmod"></p><h3 id="修改ssh配置文件"><a href="#修改ssh配置文件" class="headerlink" title="修改ssh配置文件"></a>修改ssh配置文件</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">修改ssh配置文件/etc/ssh/sshd_config，取消这行(33行) AuthorizedKeysFile    %h/.ssh/authorized_keys 前面的注释</span><br><span class="line">修改完重启ssh: <span class="built_in"> service </span>ssh restart</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/git/git_sshd_config.png" alt="git sshd_config" title="git sshd_config"></p><h3 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">为例安全，禁止 git_dafei 用户 shell登录，需要修改 /etc/passwd</span><br><span class="line">将    <span class="symbol">git_dafei:</span><span class="symbol">x:</span><span class="number">1002</span><span class="symbol">:</span><span class="number">1002</span><span class="symbol">:</span>,,,<span class="symbol">:/home/git_dafei</span><span class="symbol">:/bin/bash</span></span><br><span class="line">改为  <span class="symbol">git_dafei:</span><span class="symbol">x:</span><span class="number">1002</span><span class="symbol">:</span><span class="number">1002</span><span class="symbol">:</span>,,,<span class="symbol">:/home/git_dafei</span><span class="symbol">:/usr/bin/git-shell</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/git/git_passwd.png" alt="git passwd" title="git passwd"></p><h3 id="在win中clone刚才创建的test-git"><a href="#在win中clone刚才创建的test-git" class="headerlink" title="在win中clone刚才创建的test.git"></a>在win中clone刚才创建的test.git</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">克隆的用户有错</span><br><span class="line">git clone git_dafei<span class="variable">@192</span>.<span class="number">168.1</span>.<span class="number">113</span><span class="symbol">:/home/git_dafei/code/test</span>.git</span><br><span class="line"></span><br><span class="line">git clone 上面设置的用户名@服务器<span class="symbol">ip:</span>/home/git_dafei/code/test.git</span><br><span class="line">git clone <span class="symbol">ssh:</span>/<span class="regexp">/git_dafei@192.168.1.113:22 /home</span><span class="regexp">/git_dafei/code</span><span class="regexp">/test.git  [指定ssh端口克隆]</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/git/git_win_clone.png" alt="git win clone" title="git win clone"></p><p><img src="/img/ubuntu/git/git_win_user.png" alt="git win use" title="git win use"></p><p><img src="/img/ubuntu/git/git_ubuntu_clone.png" alt="git ubuntu clone" title="git ubuntu clone"></p><p><a href="https://help.ubuntu.com/lts/serverguide/git.html" title="Ubuntu git官方文档" target="_blank" rel="noopener">Ubuntu git官方文档</a><br><a href="https://git-scm.com/book/en/v2/Git-on-the-Server-Setting-Up-the-Server&quot;git官方文档&quot;" target="_blank" rel="noopener">git官方文档</a></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>linux ubuntu15 redis安装</title>
      <link href="/2018/02/12/ubuntu/linux_ubuntu_redis/"/>
      <url>/2018/02/12/ubuntu/linux_ubuntu_redis/</url>
      <content type="html"><![CDATA[<p>redis2种安装方式</p><h3 id="安装redis"><a href="#安装redis" class="headerlink" title="安装redis"></a>安装redis</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get <span class="keyword">install</span> redis-<span class="keyword">server</span>  </span><br><span class="line"></span><br><span class="line">启动redis</span><br><span class="line">redis-<span class="keyword">server</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/redis/redis_install.png" alt="redis install" title="redis install"></p><h3 id="检查redis-进程"><a href="#检查redis-进程" class="headerlink" title="检查redis 进程"></a>检查redis 进程</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ps</span> -aux|<span class="keyword">grep</span> redis</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/redis/reids_server.png" alt="redis server" title="redis server"></p><h3 id="终端输入：redis-cli-测试redis是否成功"><a href="#终端输入：redis-cli-测试redis是否成功" class="headerlink" title="终端输入：redis-cli 测试redis是否成功"></a>终端输入：redis-cli 测试redis是否成功</h3><p><img src="/img/ubuntu/redis/redis_cli.png" alt="redis-cli" title="redis-cli"></p><h3 id="redis-设置密码"><a href="#redis-设置密码" class="headerlink" title="redis 设置密码"></a>redis 设置密码</h3><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">reids默认是不需要密码的，设置密码</span><br><span class="line">sudo vi /etc/redis/redis.conf  </span><br><span class="line"></span><br><span class="line">在<span class="number">397</span>行：   </span><br><span class="line">取消 注释      # requirepass foobared  </span><br><span class="line">设置新密码：   requirepass redis_pwd_123456  </span><br><span class="line">让 reids 远程登录  </span><br><span class="line">注释bind，在<span class="number">69</span>行  </span><br><span class="line"># bind <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br></pre></td></tr></table></figure><p> <img src="/img/ubuntu/redis/redis_pwd_remote.png" alt="redis pwd remote" title="redis pwd remote"></p><h3 id="修改后重启redis"><a href="#修改后重启redis" class="headerlink" title="修改后重启redis"></a>修改后重启redis</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="regexp">/etc/i</span>nit.d<span class="regexp">/redis-server restart</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/redis/redis_restart.png" alt="redis restart" title="redis restart"></p><h3 id="记得使用密码登录奥！！！"><a href="#记得使用密码登录奥！！！" class="headerlink" title="记得使用密码登录奥！！！"></a>记得使用密码登录奥！！！</h3><p><img src="/img/ubuntu/redis/redis_login.png" alt="redis login" title="redis login"></p><h3 id="卸载redis"><a href="#卸载redis" class="headerlink" title="卸载redis"></a>卸载redis</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="builtin-name">get</span> purge --auto-<span class="builtin-name">remove</span> redis-server</span><br></pre></td></tr></table></figure><h2 id="2、编译安装"><a href="#2、编译安装" class="headerlink" title="2、编译安装"></a>2、编译安装</h2><h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget http:<span class="comment">//download.redis.io/releases/redis-4.0.8.tar.gz</span></span><br><span class="line">tar -xzvf redis-<span class="number">4.0</span>.<span class="number">8</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span>  -C /data/server/</span><br><span class="line">cd redis-<span class="number">4.0</span>.<span class="number">8</span>/</span><br><span class="line">make</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/redis/redis02_install.png" alt="redis02 install" title="redis02 install"></p><h3 id="启动redis"><a href="#启动redis" class="headerlink" title="启动redis"></a>启动redis</h3><p>make完后 redis-4.0.8目录下会出现编译后的redis服务程序redis-server,还有用于测试的客户端程序redis-cli,两个程序位于安装目录 src 目录下，下面启动redis服务.</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> src/</span><br><span class="line"><span class="string">./redis-server</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/redis/redis02_start.png" alt="redis02 start" title="redis02 start"></p><h3 id="redis设置密码"><a href="#redis设置密码" class="headerlink" title="redis设置密码"></a>redis设置密码</h3><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">reids默认是不需要密码的，设置密码</span><br><span class="line">vi redis.conf  </span><br><span class="line"></span><br><span class="line">在<span class="number">500</span>行：   </span><br><span class="line">取消 注释      # requirepass foobared  </span><br><span class="line">设置新密码：   requirepass redis_pwd_123456</span><br><span class="line">让 reids 远程登录  </span><br><span class="line">注释bind，在<span class="number">69</span>行  </span><br><span class="line"># bind <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br></pre></td></tr></table></figure><p> <img src="/img/ubuntu/redis/redis_pwd_remote.png" alt="redis02 pwd remote" title="redis02 pwd remote"></p><h3 id="修改后启动redis"><a href="#修改后启动redis" class="headerlink" title="修改后启动redis"></a>修改后启动redis</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src/redis-server ./redis<span class="selector-class">.conf</span>   【指定配置文件启动】</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/redis/redis02_login.png" alt="redis02 pwd login" title="redis02 pwd login"></p><h3 id="设置-reids-后台启动"><a href="#设置-reids-后台启动" class="headerlink" title="设置 reids 后台启动"></a>设置 reids 后台启动</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vi redis<span class="selector-class">.conf</span>  </span><br><span class="line"></span><br><span class="line">在<span class="number">136</span>行</span><br><span class="line">把 daemonize no 改成 daemonize yes</span><br><span class="line"></span><br><span class="line">修改完重启redis：</span><br><span class="line">src/redis-server ./redis<span class="selector-class">.conf</span>   【指定配置文件启动】</span><br><span class="line">/data/server/redis-<span class="number">4.0</span>.<span class="number">8</span>/src/redis-server ./redis<span class="selector-class">.conf</span>   【指定配置文件启动】</span><br><span class="line">后台启动后关闭命令：</span><br><span class="line">./redis-cli -h <span class="number">127.0</span>.<span class="number">0.1</span> -<span class="selector-tag">a</span> redis_pwd_123456 -<span class="selector-tag">p</span> <span class="number">6379</span> shutdown</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/redis/redis02_backend_start.png" alt="redis02 backend start" title="redis02 backend start"></p><p> <a href="http://download.redis.io/releases/&quot;redis官网下载地址&quot;" target="_blank" rel="noopener">redis官网下载地址</a></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>linux Ubuntu ssh</title>
      <link href="/2018/02/12/ubuntu/linux_ubuntu_ssh/"/>
      <url>/2018/02/12/ubuntu/linux_ubuntu_ssh/</url>
      <content type="html"><![CDATA[<h3 id="安装客户端"><a href="#安装客户端" class="headerlink" title="安装客户端"></a>安装客户端</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt <span class="keyword">install</span> openssh-<span class="keyword">client</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/ssh/ssh_client.png" alt="ssh client" title="ssh client"></p><h3 id="安装服务端"><a href="#安装服务端" class="headerlink" title="安装服务端"></a>安装服务端</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt <span class="keyword">install</span> openssh-<span class="keyword">server</span></span><br></pre></td></tr></table></figure><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">查看手册   <span class="keyword">man</span> sshd_config</span><br></pre></td></tr></table></figure><p>在编辑配置文件之前，您应该生成一个原始文件的拷贝并对其写保护，以便您可以参考原始文件并在必要时重用它。拷贝 /etc/ssh/sshd_config 文件并对其写保护可以通过在终端提示符后运行下列命令</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo cp <span class="regexp">/etc/</span>ssh<span class="regexp">/sshd_config /</span>etc<span class="regexp">/ssh/</span>sshd_config.original</span><br><span class="line">sudo chmod a-w <span class="regexp">/etc/</span>ssh<span class="regexp">/sshd_config.original</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/ssh/ssh_sshd_config.png" alt="ssh sshd_config" title="ssh sshd_config"></p><ul><li><p>要设置您 OpenSSH 在 TCP 2222 端口而不是缺省的 TCP 20 端口监听，可以如下使用改变 Port 语句：</p><p>Port 2222</p></li><li><p>要让 sshd 允许基于公钥登录证书，可以简单添加或修改该行语句：</p><p>PubkeyAuthentication yes</p><p>If the line is already present, then ensure it is not commented out.</p></li><li><p>要使您的 OpenSSH 服务器显示 /etc/issue.net 文件的内容以作为预登录 Banner，只需简单地将下行添加或修改：</p><p>Banner /etc/issue.net</p><p>在 /etc/ssh/sshd_config 文件中。</p></li></ul><p>在修改 /etc/ssh/sshd_config 文件之后，保存该文件并重启 sshd 服务器应用程序以使之生效。可以在终端提示符后使用下列命令：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">systemctl</span> <span class="selector-tag">restart</span> <span class="selector-tag">sshd</span><span class="selector-class">.service</span></span><br></pre></td></tr></table></figure><h3 id="SSH服务器命令"><a href="#SSH服务器命令" class="headerlink" title="SSH服务器命令"></a>SSH服务器命令</h3><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">停止服务：sudo /etc/init.d/ssh stop</span><br><span class="line">启动服务：sudo /etc/init.d/ssh start</span><br><span class="line">重启服务：sudo /etc/init.d/ssh restart</span><br><span class="line">登录： ssh 用户名@远程ip</span><br><span class="line">demo： ssh dafei@<span class="number">192.168</span><span class="number">.1</span><span class="number">.82</span></span><br><span class="line">  ssh -p <span class="number">22</span> dafei@<span class="number">192.168</span><span class="number">.1</span><span class="number">.82</span>   [指定端口登录]</span><br><span class="line">断开连接：exit;</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/ssh/ssh_remote_login.png" alt="ssh remote_login" title="ssh remote_login"></p><p>如果细心，可能发现远程登录不能用root登录，解决办法： 修改 /etc/ssh/sshd_config 配置文件</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">26 </span># Authentication:</span><br><span class="line"><span class="symbol">27 </span>LoginGraceTime <span class="number">120</span></span><br><span class="line"><span class="symbol">28 </span># PermitRootLogin prohibit-password    【找到这一行注释掉】</span><br><span class="line"><span class="symbol">29 </span>PermitRootLogin yes                    【改为yes】</span><br><span class="line"><span class="symbol">30 </span>StrictModes yes</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/ssh/ssh_remote_login_root.png" alt="ssh remote_login_root" title="ssh remote_login_root"></p><p><img src="/img/ubuntu/ssh/ssh_remote_login_ok.png" alt="ssh remote_login_root_ok" title="ssh remote_login_root_ok"></p><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>证书登录、无密码登录这里不在写，有需要的自己网上找资料；这个也是修改 sshd_config 文件</p><p>扩展：<br> <a href="https://help.ubuntu.com/lts/serverguide/openssh-server.html&quot;Ubuntu ssh&quot;" target="_blank" rel="noopener">Ubuntu ssh</a></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Linux ubuntu docker</title>
      <link href="/2018/02/08/ubuntu/linux_ubuntu_docker/"/>
      <url>/2018/02/08/ubuntu/linux_ubuntu_docker/</url>
      <content type="html"><![CDATA[<h3 id="Linux-ubuntu-docker"><a href="#Linux-ubuntu-docker" class="headerlink" title="Linux ubuntu docker"></a>Linux ubuntu docker</h3><p>前提条件 Docker要求Ubuntu系统内核版本高于3.10，查看内核版本</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">uname -r</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/docker/docker_get_error.png" alt="获取docker安装包报错"></p><p>系统版本没有问题，docker安装一直包这错。试一下docker命令，检查镜像信息</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br><span class="line">现在Ubuntu系统提示安装docker命令，我们执行</span><br><span class="line">apt-<span class="builtin-name">get</span> install docker.io</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/docker/docker_instal.png" alt="根据系统提示安装docker"></p><h3 id="查看docker版本"><a href="#查看docker版本" class="headerlink" title="查看docker版本"></a>查看docker版本</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">version</span></span><br><span class="line"></span><br><span class="line">sudo docker <span class="built_in">run</span> hello-world    【确认docker是否安装成功】</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/docker/docker_v.png" alt="却docker是否安装成功"></p><p>———————–到这里docker已经安装完成————————</p><h3 id="安装docker-compose"><a href="#安装docker-compose" class="headerlink" title="安装docker-compose"></a>安装docker-compose</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L <span class="keyword">https</span>://github.com/docker/compose/releases/download/<span class="number">1.17</span><span class="number">.1</span>/docker-compose-`uname -s`-`uname -m` &gt; /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line"></span><br><span class="line">sudo chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line"></span><br><span class="line">curl -L <span class="keyword">https</span>://raw.githubusercontent.com/docker/compose/<span class="number">1.8</span><span class="number">.0</span>/contrib/completion/bash/docker-compose &gt; /etc/bash_completion.d/docker-compose    【bash 补全命令】</span><br><span class="line"><span class="comment">////////如果出现超时，加上2个参数： ///////////</span></span><br><span class="line"><span class="comment">--connect-timeout 100000 -m 1000000</span></span><br><span class="line">-m为数据最大传输时间</span><br><span class="line">curl -L <span class="string">"https://github.com/docker/compose/releases/download/1.9.0/docker-compose-$(uname -s)-$(uname -m)"</span> -o /usr/<span class="built_in">local</span>/bin/docker-compose <span class="comment">--connect-timeout 100000 -m 1000000 </span></span><br><span class="line"><span class="comment">////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line">docker-compose -<span class="built_in">version</span>    【检测 docker-compose 版本】</span><br><span class="line"></span><br><span class="line">sudo rm /usr/<span class="built_in">local</span>/bin/docker-compose    【卸载docker-compose】</span><br><span class="line"></span><br><span class="line"><span class="comment">-----------------------------------------------</span></span><br><span class="line"></span><br><span class="line">docker-compose 命令</span><br><span class="line">docker-compose ps   查看容器运行状态</span><br><span class="line">docker-compose restart <span class="comment">#重启所有容器</span></span><br><span class="line">docker-compose restart App1  <span class="comment">#重启App1</span></span><br><span class="line">docker-compose <span class="built_in">stop</span> <span class="comment">#停止所有容器</span></span><br><span class="line">docker-compose rm   <span class="comment">#删除所有容器</span></span><br><span class="line">docker-compose <span class="built_in">stop</span> App1  <span class="comment">#停止App1</span></span><br><span class="line">docker-compose -f docker-compose.yml down    停止并删除容器、网络、镜像、数据卷</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/docker/docker_compose.png" alt="docker-compose"></p><p>———————–到这里docker-compose已经安装完成————————</p><h3 id="Docker-Compose-搭建-Rails"><a href="#Docker-Compose-搭建-Rails" class="headerlink" title="Docker Compose 搭建 Rails"></a>Docker Compose 搭建 Rails</h3><p>温馨提示： 复制粘贴命令的时候注意别丢信息</p><h4 id="创建项目目录"><a href="#创建项目目录" class="headerlink" title="创建项目目录"></a>创建项目目录</h4><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> myapp</span><br><span class="line"><span class="built_in">cd</span> myapp</span><br></pre></td></tr></table></figure><h4 id="创建-Dockerfile文件，包含以下内容"><a href="#创建-Dockerfile文件，包含以下内容" class="headerlink" title="创建 Dockerfile文件，包含以下内容"></a>创建 Dockerfile文件，包含以下内容</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ruby:<span class="number">2.3</span>.<span class="number">3</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get update -qq &amp;&amp; apt-get install -y build-essential libpq-dev nodejs</span></span><br><span class="line"><span class="bash">RUN mkdir /myapp</span></span><br><span class="line"><span class="bash">WORKDIR /myapp</span></span><br><span class="line"><span class="bash">COPY Gemfile /myapp/Gemfile</span></span><br><span class="line"><span class="bash">COPY Gemfile.lock /myapp/Gemfile.lock</span></span><br><span class="line"><span class="bash">RUN bundle install</span></span><br><span class="line"><span class="bash">COPY . /myapp</span></span><br></pre></td></tr></table></figure><h4 id="创建-Gemfile-文件，包含以下内容"><a href="#创建-Gemfile-文件，包含以下内容" class="headerlink" title="创建 Gemfile 文件，包含以下内容"></a>创建 Gemfile 文件，包含以下内容</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> <span class="string">'https://rubygems.org'</span></span><br><span class="line">gem <span class="string">'rails'</span>, <span class="string">'5.0.0.1'</span></span><br></pre></td></tr></table></figure><h4 id="创建空的-Gemfile-lock-文件"><a href="#创建空的-Gemfile-lock-文件" class="headerlink" title="创建空的 Gemfile.lock 文件"></a>创建空的 Gemfile.lock 文件</h4><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch Gemfile.<span class="keyword">lock</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/docker/docker_compose_Rails02.png" alt="docker-compose Rails02"></p><h4 id="创建一个-docker-compose-yml-，包含以下内容"><a href="#创建一个-docker-compose-yml-，包含以下内容" class="headerlink" title="创建一个 docker-compose.yml ，包含以下内容"></a>创建一个 docker-compose.yml ，包含以下内容</h4><p>温馨提示：<br>docker-compose.yml  中 version: ‘3’ 改为 version: ‘2’</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">version</span>: <span class="string">'2'</span></span><br><span class="line"><span class="attribute">services</span>:</span><br><span class="line">  <span class="attribute">db</span>:</span><br><span class="line">    <span class="attribute">image</span>: postgres</span><br><span class="line">  <span class="attribute">web</span>:</span><br><span class="line">    <span class="attribute">build</span>: .</span><br><span class="line">    <span class="attribute">command</span>: bundle exec rails s -p <span class="number">3000</span> -b <span class="string">'0.0.0.0'</span></span><br><span class="line">    <span class="attribute">volumes</span>:</span><br><span class="line">      - .:/myapp</span><br><span class="line">    <span class="attribute">ports</span>:</span><br><span class="line">      - <span class="string">"3000:3000"</span></span><br><span class="line">    <span class="attribute">depends_on</span>:</span><br><span class="line">      - db</span><br></pre></td></tr></table></figure><h4 id="接下来执行"><a href="#接下来执行" class="headerlink" title="接下来执行"></a>接下来执行</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose <span class="builtin-name">run</span> web rails new . --force <span class="attribute">--database</span>=postgresql</span><br></pre></td></tr></table></figure><p>查看现在的目录：  ls -l   </p><p><img src="/img/ubuntu/docker/docker_compose_Rails03.png" alt="docker-compose Rails"></p><h4 id="修改权限，重建-Docker-镜像"><a href="#修改权限，重建-Docker-镜像" class="headerlink" title="修改权限，重建 Docker 镜像"></a>修改权限，重建 Docker 镜像</h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chown -R $USER:$<span class="keyword">USER</span> <span class="title">.</span></span><br><span class="line"><span class="title">docker-compose</span> build</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/docker/docker_compose_Rails04.png" alt="docker-compose Rails"></p><h4 id="修改-config-database-yml-文件"><a href="#修改-config-database-yml-文件" class="headerlink" title="修改 config/database.yml 文件"></a>修改 config/database.yml 文件</h4><p>如果担心修改错误，可以先备份原文件： cp database.yml database.yml_backup</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">清空</span> <span class="string">database.yml</span> <span class="string">文件</span></span><br><span class="line"><span class="string">echo</span> <span class="string">" "</span><span class="string">&gt;database.yml</span></span><br><span class="line"></span><br><span class="line"><span class="string">database.yml</span> <span class="string">文件写入以下内容</span></span><br><span class="line"></span><br><span class="line"><span class="attr">default:</span> <span class="meta">&amp;default</span></span><br><span class="line"><span class="attr">  adapter:</span> <span class="string">postgresql</span></span><br><span class="line"><span class="attr">  encoding:</span> <span class="string">unicode</span></span><br><span class="line"><span class="attr">  host:</span> <span class="string">db</span></span><br><span class="line"><span class="attr">  username:</span> <span class="string">postgres</span></span><br><span class="line"><span class="attr">  password:</span></span><br><span class="line"><span class="attr">  pool:</span> <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="attr">development:</span></span><br><span class="line">  <span class="string">&lt;&lt;:</span> <span class="meta">*default</span></span><br><span class="line"><span class="attr">  database:</span> <span class="string">myapp_development</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">test:</span></span><br><span class="line">  <span class="string">&lt;&lt;:</span> <span class="meta">*default</span></span><br><span class="line"><span class="attr">  database:</span> <span class="string">myapp_test</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/docker/docker_compose_Rails05.png" alt="docker-compose Rails"></p><h4 id="启动应用"><a href="#启动应用" class="headerlink" title="启动应用"></a>启动应用</h4><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker-compose up</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/docker/docker_compose_Rails06.png" alt="docker-compose Rails"></p><h4 id="创建数据库，在另一个终端中，执行"><a href="#创建数据库，在另一个终端中，执行" class="headerlink" title="创建数据库，在另一个终端中，执行"></a>创建数据库，在另一个终端中，执行</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose <span class="keyword">run</span><span class="bash"> web rake db:create</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/docker/docker_compose_Rails07.png" alt="docker-compose Rails"></p><p>用浏览器访问 <a href="http://localhost:3000/" target="_blank" rel="noopener">http://localhost:3000</a> ，你会看到 Rails 的欢迎信息：</p><p><img src="/img/ubuntu/docker/docker_compose_Rails.png" alt="docker-compose Rails"></p><h4 id="If-you-are-using-Docker-Machine-then-docker-machine-ip-MACHINE-VM-returns-the-Docker-host-IP-address-to-which-you-can-append-the-port-lt-Docker-Host-IP-gt-3000"><a href="#If-you-are-using-Docker-Machine-then-docker-machine-ip-MACHINE-VM-returns-the-Docker-host-IP-address-to-which-you-can-append-the-port-lt-Docker-Host-IP-gt-3000" class="headerlink" title="If you are using Docker Machine, then docker-machine ip MACHINE_VM returns the Docker host IP address, to which you can append the port (&lt;Docker-Host-IP&gt;:3000)."></a>If you are using <a href="https://docs.docker.com/machine/overview/" target="_blank" rel="noopener">Docker Machine</a>, then <code>docker-machine ip MACHINE_VM</code> returns the Docker host IP address, to which you can append the port (<code>&lt;Docker-Host-IP&gt;:3000</code>).</h4><p><img src="/img/ubuntu/docker/docker_compose_Rails08.png" alt="docker-compose Rails"></p><p><a href="https://docs.docker.com/compose/rails/#rebuild-the-application" title="docker-compose 安装Rails官方文档" target="_blank" rel="noopener">Compose and Rail 官方文档</a></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>ubuntu系统</title>
      <link href="/2018/02/07/ubuntu/linux_ubuntu_centos/"/>
      <url>/2018/02/07/ubuntu/linux_ubuntu_centos/</url>
      <content type="html"><![CDATA[<h3 id="虚拟机安装完ubuntu后root没有密码"><a href="#虚拟机安装完ubuntu后root没有密码" class="headerlink" title="虚拟机安装完ubuntu后root没有密码"></a>虚拟机安装完ubuntu后root没有密码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">设置root密码</span><br><span class="line">sudo password</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/linux_command/linux_00/root_passwd.png" alt="root passwd"></p><h3 id="虚拟机安装完centos后重新设置root密码"><a href="#虚拟机安装完centos后重新设置root密码" class="headerlink" title="虚拟机安装完centos后重新设置root密码"></a>虚拟机安装完centos后重新设置root密码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">设置root密码</span><br><span class="line">passwd</span><br></pre></td></tr></table></figure><hr><h3 id="用户切换："><a href="#用户切换：" class="headerlink" title="用户切换："></a>用户切换：</h3><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="keyword">su</span> (切换到root用户)；    </span><br><span class="line"><span class="keyword">su</span> user（user是你自己安装时候的用户名；切换到普通用户）</span><br><span class="line"></span><br><span class="line">其他命令：</span><br><span class="line">修改文件权限：</span><br><span class="line">    sudo chmod -R 777 文件名</span><br><span class="line">安装文件命令：</span><br><span class="line">    sudo apt-get install 文件名</span><br><span class="line">   清空某个文件</span><br><span class="line">   echo <span class="string">""</span> &gt;<span class="keyword">log</span>.<span class="built_in">log</span></span><br><span class="line">   动态查看内容</span><br><span class="line">   tail -f api_v1.<span class="built_in">log</span></span><br><span class="line">   修改文件权限</span><br><span class="line">    sudo chmod -R 777 文件名</span><br></pre></td></tr></table></figure><h3 id="安装好系统后，vi不能正常使用方向键和退格键"><a href="#安装好系统后，vi不能正常使用方向键和退格键" class="headerlink" title="安装好系统后，vi不能正常使用方向键和退格键"></a>安装好系统后，vi不能正常使用方向键和退格键</h3><p>ubuntu中vi在编辑状态下方向键不能用，还有回格键不能删除等我们平时习惯的一些键都不能使用。解决办法：可以安装vim full版本，在full版本下键盘正常，安装好后同样使用vi命令。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">-----------（1）-----一般安装步骤------------------</span></span><br><span class="line">   sudo apt-get remove vim-common</span><br><span class="line">   sudo apt-get <span class="keyword">install</span> vim</span><br><span class="line"><span class="comment">-----------（2）------直接安装vim 报错 packet 不存在、找不到  请换源，参考下面-----------</span></span><br><span class="line">进入/etc/apt/</span><br><span class="line">cd /etc/apt</span><br><span class="line">对 sources.list文件进行备份</span><br><span class="line">sudo cp sources.list sources.list.bak</span><br><span class="line">删除掉 sources.list 中的内容【命令 echo <span class="string">""</span>&gt;sources.list  】，选择阿里云源</span><br><span class="line"></span><br><span class="line">deb <span class="keyword">http</span>://mirrors.aliyun.com/ubuntu/ xenial <span class="keyword">main</span> <span class="keyword">restricted</span> universe multiverse</span><br><span class="line">deb <span class="keyword">http</span>://mirrors.aliyun.com/ubuntu/ xenial-<span class="keyword">security</span> <span class="keyword">main</span> <span class="keyword">restricted</span> universe multiverse</span><br><span class="line">deb <span class="keyword">http</span>://mirrors.aliyun.com/ubuntu/ xenial-updates <span class="keyword">main</span> <span class="keyword">restricted</span> universe multiverse</span><br><span class="line">deb <span class="keyword">http</span>://mirrors.aliyun.com/ubuntu/ xenial-proposed <span class="keyword">main</span> <span class="keyword">restricted</span> universe multiverse</span><br><span class="line">deb <span class="keyword">http</span>://mirrors.aliyun.com/ubuntu/ xenial-backports <span class="keyword">main</span> <span class="keyword">restricted</span> universe multiverse</span><br><span class="line">deb-src <span class="keyword">http</span>://mirrors.aliyun.com/ubuntu/ xenial <span class="keyword">main</span> <span class="keyword">restricted</span> universe multiverse</span><br><span class="line">deb-src <span class="keyword">http</span>://mirrors.aliyun.com/ubuntu/ xenial-<span class="keyword">security</span> <span class="keyword">main</span> <span class="keyword">restricted</span> universe multiverse</span><br><span class="line">deb-src <span class="keyword">http</span>://mirrors.aliyun.com/ubuntu/ xenial-updates <span class="keyword">main</span> <span class="keyword">restricted</span> universe multiverse</span><br><span class="line">deb-src <span class="keyword">http</span>://mirrors.aliyun.com/ubuntu/ xenial-proposed <span class="keyword">main</span> <span class="keyword">restricted</span> universe multiverse</span><br><span class="line">deb-src <span class="keyword">http</span>://mirrors.aliyun.com/ubuntu/ xenial-backports <span class="keyword">main</span> <span class="keyword">restricted</span> universe multiverse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">------------（3）换源结束-------------------------------</span></span><br><span class="line">apt-<span class="keyword">get</span> <span class="keyword">update</span>   先更新一下</span><br><span class="line"></span><br><span class="line">现在可以安装vim</span><br><span class="line"> sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> vim</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>数据库账号管理</title>
      <link href="/2018/02/01/mysql_DDU_%E6%95%B0%E6%8D%AE%E5%BA%93%E8%B4%A6%E5%8F%B7/"/>
      <url>/2018/02/01/mysql_DDU_%E6%95%B0%E6%8D%AE%E5%BA%93%E8%B4%A6%E5%8F%B7/</url>
      <content type="html"><![CDATA[<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ul><li>分配数据库账号权限时，请按最小权限原则和业务角色创建账号，并合理分配只读和读写权限。必要时可以把数据库账号和数据库拆分成更小粒度，使每个数据库账号只能访问其业务之内的数据。如果不需要数据库写入操作，请分配只读权限</li><li>为保障数据库的安全，请将数据库账号的密码设置为强密码，并定期更换。</li></ul>]]></content>
      
      
    </entry>
    
    <entry>
      <title>linux-DDU 创建文件和目录的副本  -cp</title>
      <link href="/2018/01/29/ubuntu/linux_DDU_cp/"/>
      <url>/2018/01/29/ubuntu/linux_DDU_cp/</url>
      <content type="html"><![CDATA[<h3 id="不带任何参数-运行cp"><a href="#不带任何参数-运行cp" class="headerlink" title="不带任何参数,运行cp"></a>不带任何参数,运行cp</h3><p>cp最基本命令，拷贝file_3.txt 从一个位置复制到另一个位置</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ls -all     【递归展示目录本文中会多次用到】</span><br><span class="line">----------------------------</span><br><span class="line">cp file<span class="emphasis">_3.txt /home/destination_</span>file</span><br><span class="line">或者</span><br><span class="line">cp /home/soruce<span class="emphasis">_file2/file_</span>3.txt /home/destination<span class="emphasis">_file</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/linux_command/linux_cp/cp.png" alt="cp" title="cp"></p><h3 id="拷贝多个文件"><a href="#拷贝多个文件" class="headerlink" title="拷贝多个文件"></a>拷贝多个文件</h3><p>拷贝多个文件，我们只需将文件名字用空格隔开。或者使用*拷贝所有文件</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp file_3.txt file_4.txt /<span class="built_in">home</span>/destination_file</span><br><span class="line">cp *  /<span class="built_in">home</span>/destination_file       【拷贝所有文件，注意观察截图，aaa目录没有拷贝成功，稍后解决】</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/linux_command/linux_cp/cp_02.png" alt="cp 多个文件" title="cp 多个文件"></p><h3 id="拷贝一个目录"><a href="#拷贝一个目录" class="headerlink" title="拷贝一个目录"></a>拷贝一个目录</h3><p>-r 或者 -R ，不论目录是否为空都会拷贝</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -r <span class="keyword">aaa</span>/ /home/destination_file     【这就解决上次没有拷贝<span class="keyword">aaa</span>目录】</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/linux_command/linux_cp/cp_r.png" alt="cp 递归拷贝目录" title="cp 递归拷贝目录"></p><h3 id="创建文件硬链接，而不是拷贝他们"><a href="#创建文件硬链接，而不是拷贝他们" class="headerlink" title="创建文件硬链接，而不是拷贝他们"></a>创建文件硬链接，而不是拷贝他们</h3><p>拷贝文件意味着你必须使用一些存储空间来储存拷贝的文件。有时候出于某种原因，你可能想要创建“快捷方式”或者链接到文件，而不是拷贝它们。要做到这一点，我们可以使用-l选项。</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -l file_3<span class="selector-class">.txt</span> /home/destination_file</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/linux_command/linux_cp/cp_l.png" alt="cp 拷贝硬链接" title="cp 拷贝硬链接"></p><h3 id="创建文件的软连接【符号链接、快捷方式…-】"><a href="#创建文件的软连接【符号链接、快捷方式…-】" class="headerlink" title="创建文件的软连接【符号链接、快捷方式…..】"></a>创建文件的软连接【符号链接、快捷方式…..】</h3><p>软连接（符号链接）用 -s实现</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">cp</span> <span class="selector-tag">-s</span> <span class="selector-tag">file_3</span><span class="selector-class">.txt</span> <span class="selector-tag">file_44</span><span class="selector-class">.txt</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/linux_command/linux_cp/cp_s.png" alt="cp 拷贝软链接" title="cp 软链接"></p><h3 id="文件归档"><a href="#文件归档" class="headerlink" title="文件归档"></a>文件归档</h3><p>使用 -a 选项来归档文件。保留链接和文件属性，递归拷贝目录，相当于下面的d、p、r三个选项组合。</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -a  * /<span class="built_in">home</span>/destination_file/</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/linux_command/linux_cp/cp_a.png" alt="cp a" title="cp a"></p><h4 id="只拷贝文件属性"><a href="#只拷贝文件属性" class="headerlink" title="只拷贝文件属性"></a>只拷贝文件属性</h4><p>只拷贝文件属性，不拷贝文件内容，使用 –attributes-only 选项</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp <span class="params">--attributes-only</span> file_3.txt <span class="string">/home/destination_file/</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/linux_command/linux_cp/cp_attributes_only.png" alt="cp --attributes-only" title="cp 拷贝文件属性，不拷贝内容"></p><h3 id="显示正在做什么"><a href="#显示正在做什么" class="headerlink" title="显示正在做什么"></a>显示正在做什么</h3><p>默认情况下，拷贝是不会显示拷贝时发生了什么，我们可以使用 -v选项</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -v  * /<span class="built_in">home</span>/destination_file/</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/linux_command/linux_cp/cp_v.png" alt="cp v" title="cp v显示信息"></p><h3 id="目标文件时间是最新更改，源文件时间老"><a href="#目标文件时间是最新更改，源文件时间老" class="headerlink" title="目标文件时间是最新更改，源文件时间老"></a>目标文件时间是最新更改，源文件时间老</h3><p>拷贝时，目标文件先存着和源文件同名文件，切目标文件时间是最新更改，使用 -u,不会覆盖最新文件</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -vu file_3<span class="selector-class">.txt</span> file_4<span class="selector-class">.txt</span> /home/destination_file/</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/linux_command/linux_cp/cp_u.png" alt="cp u" title="cp 跳过目标最新文件"></p><h3 id="使用交互模式"><a href="#使用交互模式" class="headerlink" title="使用交互模式"></a>使用交互模式</h3><p>交互模式下会询问是否覆盖目标目录下的文件。使用 -i 选项</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -<span class="selector-tag">i</span> file_3<span class="selector-class">.txt</span> file_4<span class="selector-class">.txt</span> /home/destination_file/</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/linux_command/linux_cp/cp_i.png" alt="cp i" title="cp 交互模式"></p><h3 id="创建备份文件"><a href="#创建备份文件" class="headerlink" title="创建备份文件"></a>创建备份文件</h3><p>目标文件中存在与源文件同名文件，使用 -b 选项，备份目标文件，拷贝新文件</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -bv * /<span class="built_in">home</span>/destination_file/</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/linux_command/linux_cp/cp_b.png" alt="cp b" title="cp 拷贝备份"></p><h3 id="强制拷贝"><a href="#强制拷贝" class="headerlink" title="强制拷贝"></a>强制拷贝</h3><p>使用 -f 强制拷贝文件。如果目标文件不能打开，可以用 -f 尝试一下。</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -f * /<span class="built_in">home</span>/destination_file/</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/linux_command/linux_cp/cp_f.png" alt="cp f" title="cp 强制拷贝"></p><h4 id="在拷贝之前先删除目标"><a href="#在拷贝之前先删除目标" class="headerlink" title="在拷贝之前先删除目标"></a>在拷贝之前先删除目标</h4><p>可以用，–remove-destination 选项 实现。这个选项与上面的-f选项形成对照。如果 cp 命令在目标目录下发现同名文件， cp 命令会先删除目标文件，然后再拷贝一份新的。</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp --<span class="built_in">remove</span>-destination -v * /<span class="built_in">home</span>/destination_file/</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/linux_command/linux_cp/cp_remove_destination.png" alt="cp cp_remove_destination.png" title="cp 拷贝前删除目标"></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>阿里云CDN上实现https</title>
      <link href="/2018/01/18/%E9%98%BF%E9%87%8C%E4%BA%91CDN%E4%B8%8A%E5%AE%9E%E7%8E%B0https/"/>
      <url>/2018/01/18/%E9%98%BF%E9%87%8C%E4%BA%91CDN%E4%B8%8A%E5%AE%9E%E7%8E%B0https/</url>
      <content type="html"><![CDATA[<h3 id="SSL证书管理"><a href="#SSL证书管理" class="headerlink" title="SSL证书管理"></a>SSL证书管理</h3><p>对于静态资源的请求，由于存储在阿里OSS上，并在前端使用了阿里云CDN,因此将相关SSL证书的信息在阿里云CDN上配置一下就ok。</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">客户端</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">请求（js</span><span class="string">,</span><span class="comment">img，css）</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">CDN</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">云存储OSS</span></span><br></pre></td></tr></table></figure><h3 id="从阿里云CA证书服务下载证书"><a href="#从阿里云CA证书服务下载证书" class="headerlink" title="从阿里云CA证书服务下载证书"></a>从阿里云CA证书服务下载证书</h3><p><img src="/img/ali/ali_CDN_https/CA.png" alt="ali CA"></p><p>下载解压后得到2个文件：  xxx.pem   xxx.key</p><h3 id="在阿里云CDN管理控制台找到-HTTPS设置"><a href="#在阿里云CDN管理控制台找到-HTTPS设置" class="headerlink" title="在阿里云CDN管理控制台找到 HTTPS设置"></a>在阿里云CDN管理控制台找到 HTTPS设置</h3><p>点击域名中的配置,然后找到HTTPS设置，修改配置</p><p><img src="/img/ali/ali_CDN_https/HTTPS_config_01.png" alt="ali https1"></p><p>打开之前下载好的xxx.pem 和 xxx.key ,将里面的内容分别复制到证书对应位置,建议跳转类型设置为默认，保存之后用HTTPS访问你的静态资源，测试一下</p><p><img src="/img/ali/ali_CDN_https/HTTPS_config_02.png" alt="ali https2"></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>计算两点之间的距离</title>
      <link href="/2017/12/30/mysql_DDU_%E8%AE%A1%E7%AE%97%E4%B8%A4%E7%82%B9%E4%B9%8B%E9%97%B4%E7%9A%84%E8%B7%9D%E7%A6%BB/"/>
      <url>/2017/12/30/mysql_DDU_%E8%AE%A1%E7%AE%97%E4%B8%A4%E7%82%B9%E4%B9%8B%E9%97%B4%E7%9A%84%E8%B7%9D%E7%A6%BB/</url>
      <content type="html"><![CDATA[<h3 id="MySql查询执行流程图"><a href="#MySql查询执行流程图" class="headerlink" title="MySql查询执行流程图"></a>MySql查询执行流程图</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">发送语句</span><br><span class="line">查询缓存</span><br><span class="line">查询优化</span><br><span class="line">执行查询</span><br><span class="line">返回结果</span><br></pre></td></tr></table></figure><p><img src="/img/mysql/MySql_query_execution_flow_chart.png" alt="mysql查询执行流程图"></p><h3 id="计算两点之间的距离"><a href="#计算两点之间的距离" class="headerlink" title="计算两点之间的距离"></a>计算两点之间的距离</h3><p>一个典型的例子是计算以某个点为中心，一定半径内的所有点。典型的实际案例可能是查找某个附近所有可以出租的房子，或者社交网站中“匹配”附近的用户，等等。假设我们有如下表：<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `locations` (</span><br><span class="line">  `id` int(11) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` varchar(30)<span class="built_in"> DEFAULT </span><span class="literal">NULL</span>,</span><br><span class="line">  `lat` float <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  `lon` float <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) <span class="attribute">ENGINE</span>=MyISAM<span class="built_in"> DEFAULT </span><span class="attribute">CHARSET</span>=latin1;</span><br><span class="line"></span><br><span class="line">INSERT INTO locations(name,lat,lon)VALUES(<span class="string">"Charlottesville,Virginia"</span>,38.03,-78.48),(<span class="string">"Chicago,Illinois"</span>,41.85,-87.65),(<span class="string">"Mashington,DC"</span>,38.89,-77.04)</span><br></pre></td></tr></table></figure></p><p>这里经度和纬度的单位是“度”，通常我们假设地球是圆的，然后使用两点所在最大圆（半正矢）公式来计算两点之间的距离。现在有坐标latA和lonA、latB和lonB，那么点A和点B的距离计算公式如下：</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">AcOS(</span><br><span class="line">COS(<span class="name">latA</span>)*COS(latB)*COS(<span class="name">lonA-lonB</span>)</span><br><span class="line">+SIN(<span class="number">1</span>atA)*SIN(LatB)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>计算出的结果是一个弧度，如果要将结果的单位转换成英里或者千米，则需要乘以地球的半径，也就是3959英里或者6371千米。假设我们需要找出所有距离Baron所居住的地方Charlottesville100英里以内的点，那么我们需要将经纬度带入上面的计算公式：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM locations </span><br><span class="line">WHERE </span><br><span class="line">3979*ACOS(</span><br><span class="line">COS(radians(lat))<span class="strong">*COS(radians(38.03))*</span>COS(radians(lon)-radians(-78.48))+</span><br><span class="line">SIN(radians(lat))<span class="strong">*SIN(radians(38.03))</span></span><br><span class="line"><span class="strong">)&lt;=100;</span></span><br><span class="line"><span class="strong"></span></span><br><span class="line"><span class="strong">+----+--------------------------+-------+--------+</span></span><br><span class="line"><span class="strong">| id | name                     | lat   | lon    |</span></span><br><span class="line"><span class="strong">+----+--------------------------+-------+--------+</span></span><br><span class="line"><span class="strong">|  1 | Charlottesville,Virginia | 38.03 | -78.48 |</span></span><br><span class="line"><span class="strong">|  3 | Mashington,DC            | 38.89 | -77.04 |</span></span><br><span class="line"><span class="strong">+----+--------------------------+-------+--------+</span></span><br></pre></td></tr></table></figure><p>这类查询不仅无法使用索引，而且还会非常消耗CPU时间，给服务器带来很大的压力，而且我们还得反复计算这个。那要怎样优化呢?这个设计中有几个地方可以微优化。第一，看看是否真的需要这么精确的计算。其实这种算法已经有很多不精确的地方了，如下所示：两个地方之间的直线距离可能是100英里，但实际上它们之间的行走距离很可能不是这个值。无论你们在哪两个地方，要到达彼此位置的行走距离多半都不是直线距离，路上可能需要绕很多的弯，比如说如果有一条河，需要绕远走到一个有桥的地方。所以，这里计算的绝对距离只是一个参考值。</p><p>如果我们根据邮政编码来确定某个人所在的地区，再根据这个地区的中心位置计算他和别人的距离，那么这本身就是一个估算。Baron 住在Charlottesville，不过不是在中心地区，他对华盛顿物理位置的中心也不感兴趣。所以，通常并不需要精确计算，很多应用如果这样计算，多半是认真过头了。这类似于有效数字的估算：计算结果的精度永远都不会比测量的值更高。（换句话说，“错进，错出”。）</p><p>如果不需要太高的精度，那么我们认为地球是圆的应该也没什么问题，其实准确的说应该是椭圆。根据毕达哥拉斯定理，做些三角函数变换，我们可以把上面的公式转换得更简单，只需要做些求和、乘积以及平方根运算，就可以得出一个点是否在另一个点多少英里之内。益习等等，为什么就到这为止？我们是否真需要计算一个圆周呢？为什么不直接使用一个正方形代替?边长为200英里的正方形，一个顶点到中心的距离大概是141英里，这和实际计算的100英里相差得并不是那么远。那我们根据正方形公式来计算弧度为0.0253（100英里）的中心到边长的距离：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM locations </span><br><span class="line">WHERE lat BETWEEN 38.03 - DEGREES(0.0253) AND 38.03 + DEGREES(0.0253)</span><br><span class="line">AND   lon BETWEEN -78.48 - DEGREES(0.0253) AND -78.48 + DEGREES(0.0253);</span><br><span class="line"></span><br><span class="line"><span class="code">+----+</span>--------------------------<span class="code">+-------+</span>--------+</span><br><span class="line">| id | name                     | lat   | lon    |</span><br><span class="line"><span class="code">+----+</span>--------------------------<span class="code">+-------+</span>--------+</span><br><span class="line">|  1 | Charlottesville,Virginia | 38.03 | -78.48 |</span><br><span class="line">|  3 | Mashington,DC            | 38.89 | -77.04 |</span><br><span class="line"><span class="code">+----+</span>--------------------------<span class="code">+-------+</span>--------+</span><br></pre></td></tr></table></figure><p>现在我们看看如何使用索引来优化这个查询。简单地，我们可以增加索引（lat,lon)或者（lon,lat)。不过这样做效果并不会很好。正如我们所知，MySQL5.5和之前的版本，如果第一列是范围查询的话，就无法使用素引后面的列了。因为两个列都是范围的，所以这里只能使用索引的一个列（BETMEEN等效于一个大于和一个小于）。我们再次想起了通常使用的IN（）优化。我们先新增两个列，用来存储坐标的近似值FLOOR()，然后在查询中使用IN（）将所有点的整数值都放到列表中。下面是我们需要新增的列和索引：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE locations <span class="builtin-name">ADD</span> lat_floor INT <span class="keyword">NOT</span> <span class="literal">NULL</span><span class="built_in"> DEFAULT </span>0, </span><br><span class="line"><span class="builtin-name">ADD</span> lon_floor INT <span class="keyword">NOT</span> <span class="literal">NULL</span><span class="built_in"> DEFAULT </span>0, </span><br><span class="line"><span class="builtin-name">ADD</span> KEY (lat_floor,lon_floor);</span><br><span class="line"></span><br><span class="line">-----------------------------------------</span><br><span class="line"></span><br><span class="line">UPDATE locations</span><br><span class="line"><span class="builtin-name">SET</span> lat_floor = FLOOR(lat),<span class="attribute">lon_floor</span>=FLOOR(lon);</span><br></pre></td></tr></table></figure><p>现在我们可以根据坐标的一定范围的近似值来搜索了，这个近似值包括最小值和最大值，地理上分别对应的是南北。下面的查询为我们只展示了如何查某个范围的所有点：数值需要在应用程序中计算而不是MySQL中：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SELECT  FLOOR(38.03 - DEGREES(0.0253))AS lat<span class="emphasis">_1b,</span></span><br><span class="line"><span class="emphasis">CEILING( 38.03 + DEGREES(0.0253))AS lat_</span>lub,</span><br><span class="line">FLOOR(-78.48 - DEGREES(0.0253))AS 1on<span class="emphasis">_1b,</span></span><br><span class="line"><span class="emphasis">CEILING(-78.48 + DEGREES(0.0253))AS 1on_</span>ub;</span><br><span class="line">------------------------------------------------------</span><br><span class="line"><span class="code">+--------+</span>---------<span class="code">+--------+</span>--------+</span><br><span class="line">| lat<span class="emphasis">_1b | lat_</span>lub | 1on<span class="emphasis">_1b | 1on_</span>ub |</span><br><span class="line"><span class="code">+--------+</span>---------<span class="code">+--------+</span>--------+</span><br><span class="line">|     36 |      40 |    -80 |    -77 |</span><br><span class="line"><span class="code">+--------+</span>---------<span class="code">+--------+</span>--------+</span><br></pre></td></tr></table></figure><p>现在我们就可以生成IN（）列表中的整数了，也就是前面计算的地板和天花板数值之间的数字。下面是加上WHERE条件的完整查询：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">现在我们就可以生成IN（）列表中的整数了，也就是前面计算的地板和天花板数值之间的数字。下面是加上WHERE条件的完整查询：</span><br><span class="line"></span><br><span class="line">SELECT * FROM locations</span><br><span class="line">WHERE lat BETWEEN <span class="number">38.03</span>-DEGREES(<span class="number">0.0253</span>)AND <span class="number">38.03</span> + DEGREES(<span class="number">0.0253</span>)</span><br><span class="line">AND lon BETWEEN<span class="number">-78.48</span>-DEGREES(<span class="number">0.0253</span>)AND<span class="number">-78.48</span> +DEGREES(<span class="number">0.0253</span>)</span><br><span class="line">AND lat_floor IN(<span class="number">36</span>,<span class="number">37</span>,<span class="number">38</span>,<span class="number">39</span>,<span class="number">40</span>)AND lon_floor IN(<span class="number">-80</span>,<span class="number">-79</span>,<span class="number">-78</span>,<span class="number">-77</span>);</span><br><span class="line"></span><br><span class="line">+----+--------------------------+-------+--------+-----------+-----------+</span><br><span class="line">| id | name                     | lat   | lon    | lat_floor | lon_floor |</span><br><span class="line">+----+--------------------------+-------+--------+-----------+-----------+</span><br><span class="line">|  <span class="number">1</span> | Charlottesville,Virginia | <span class="number">38.03</span> | <span class="number">-78.48</span> |        <span class="number">38</span> |       <span class="number">-79</span> |</span><br><span class="line">|  <span class="number">3</span> | Mashington,DC            | <span class="number">38.89</span> | <span class="number">-77.04</span> |        <span class="number">38</span> |       <span class="number">-78</span> |</span><br><span class="line">+----+--------------------------+-------+--------+-----------+-----------+</span><br></pre></td></tr></table></figure></p><p>使用近似值会让我们的计算结果有些偏差，所以我们还需要一些额外的条件剔除在正方形之外的点。这和前面使用CRC32做哈希索引类似：先建一个索引帮我们过滤出近似值，再使用精确条件匹配所有的记录并移除不满足条件的记录。事实上，到这时我们就无须根据正方形的近似来过滤数据了，我们可以使用最大圆公式或者毕达哥拉斯定理来计算：</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM locations</span><br><span class="line">WHERE lat_floor IN(<span class="number">36</span>,<span class="number">37</span>,<span class="number">38</span>,<span class="number">39</span>,<span class="number">40</span>)</span><br><span class="line">AND lon_floor IN(<span class="number">-80</span>,<span class="number">-79</span>,<span class="number">-78</span>,<span class="number">-77</span>)</span><br><span class="line">AND <span class="number">3979</span>*ACOS(</span><br><span class="line">COS(radians(lat))*COS(radians(<span class="number">38.03</span>))*COS(radians(lon)-radians(<span class="number">-78.48</span>))+SIN(radians(lat))*SIN(radians(<span class="number">38.03</span>))</span><br><span class="line">)&lt;=<span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">----------------------------------------------</span><br><span class="line"></span><br><span class="line">+----+--------------------------+-------+--------+-----------+-----------+</span><br><span class="line">| id | name                     | lat   | lon    | lat_floor | lon_floor |</span><br><span class="line">+----+--------------------------+-------+--------+-----------+-----------+</span><br><span class="line">|  <span class="number">1</span> | Charlottesville,Virginia | <span class="number">38.03</span> | <span class="number">-78.48</span> |        <span class="number">38</span> |       <span class="number">-79</span> |</span><br><span class="line">|  <span class="number">3</span> | Mashington,DC            | <span class="number">38.89</span> | <span class="number">-77.04</span> |        <span class="number">38</span> |       <span class="number">-78</span> |</span><br><span class="line">+----+--------------------------+-------+--------+-----------+-----------+</span><br></pre></td></tr></table></figure><p>这时计算精度再次回到前面——使用一个精确的圆周——不过，现在的做法更快。只要能够高效地过滤掉大部分的点，例如使用近似整数和索引，之后再做精确数学计算的代价并不大。只是不要直接使用大圆周的算法，否则速度会很慢。</p><p>Sphinx有很多内置的地理信息搜索功能，比MySQL实现要好很多。如果正在考虑使用MyISAM的GIS函数，并使用上面的技巧来计算，那么你需要记住：这样做效果并不会很好，MyISAM本身也并不适合大数据量、高并发的应用，另外MyISAM本身还有一些弱点，如数据文件崩溃、表级锁等。</p><h3 id="回顾一下上面的案例，我们采用了下面这些常用的优化策略："><a href="#回顾一下上面的案例，我们采用了下面这些常用的优化策略：" class="headerlink" title="回顾一下上面的案例，我们采用了下面这些常用的优化策略："></a>回顾一下上面的案例，我们采用了下面这些常用的优化策略：</h3><p>·尽量少做事，可能的话尽量不做事。这个案例中就不要对所有的点计算大圆周公式；先使用简单的方案过滤大多数数据，然后再到过滤出来的更小的集合上使用复杂的公式运算。</p><p>快速地完成事情。确保在你的设计中尽可能地让查询都用上合适的索引，使用近似计算（例如本案例中，认为地球是平的，使用一个正方形来近似圆周）来避免复杂的计算。</p><p>需要的时候，尽可能让应用程序完成一些计算。例如本案例中，在应用程序中计算所有的三角函数。</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>linux-DDU 移动或重命名文件/目录 -mv</title>
      <link href="/2017/12/19/ubuntu/linux_DDU_mv/"/>
      <url>/2017/12/19/ubuntu/linux_DDU_mv/</url>
      <content type="html"><![CDATA[<h3 id="移动文件"><a href="#移动文件" class="headerlink" title="移动文件"></a>移动文件</h3><p>移动文件时需要注意的是文件的源地址和目标地址必须不同。这里有个例子，想要将file_1.txt文件从当前目录移动到其它目录，以/home/destination_file为例，语法应该如下：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv file_1<span class="selector-class">.txt</span> /home/destination_file/</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/linux_command/linux_mv/mv.png" alt="linux mv"></p><h3 id="移动多个文件"><a href="#移动多个文件" class="headerlink" title="移动多个文件"></a>移动多个文件</h3><p>如果想一次移动多个文件，我们可以将他们放在一行并用空格分开。</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mv file_2<span class="selector-class">.txt</span> file_3<span class="selector-class">.txt</span> file_4<span class="selector-class">.txt</span> /home/destination_file/</span><br><span class="line">或者</span><br><span class="line">mv file_&#123;<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;<span class="selector-class">.txt</span> /home/destination_file/</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/linux_command/linux_mv/mv_much.png" alt="linux mv 移动多个文件夹"></p><p>如果你的文件夹有规律可循那么你就可以使用通配符，比如，为了移除所有以.txt为扩展名的文件夹，我们可以使用下面的命令：</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv *<span class="string">.txt</span> <span class="string">/home/destination_file/</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/linux_command/linux_mv/mv_much02.png" alt="linux mv 移动多个文件夹"></p><h3 id="移动目录"><a href="#移动目录" class="headerlink" title="移动目录"></a>移动目录</h3><p>不同于复制命令，用mv命令移动目录相当于直接。移动目录你可以使用不带选项的mv命令。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv <span class="regexp">/soruce_file/</span> <span class="regexp">/home/</span>destination_file<span class="regexp">/</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/linux_command/linux_mv/mv_directory.png" alt="linux mv 移动目录"></p><h3 id="重命名文件或目录"><a href="#重命名文件或目录" class="headerlink" title="重命名文件或目录"></a>重命名文件或目录</h3><p>我们也用mv命令来重命名文件或目录，不过目标位置必须相同才可以。然后文件名字必须不同。假定我们当前做所在目录为/home/soruce_file</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mv file_1<span class="selector-class">.txt</span> file_new1.txt</span><br><span class="line">如果是绝对路径，应该像下面这样：</span><br><span class="line">mv /home/soruce_file/file_2<span class="selector-class">.txt</span> /home/soruce_file/file_new2.txt</span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/linux_command/linux_mv/mv_re_directory.png" alt="linux mv 重命名文件或目录"></p><h3 id="重命名目录"><a href="#重命名目录" class="headerlink" title="重命名目录"></a>重命名目录</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">上一段的规则同样适用于目录。</span><br><span class="line">mv <span class="regexp">/home/</span>soruce_file<span class="regexp">/ /</span>home<span class="regexp">/soruce_file2/</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/linux_command/linux_mv/mv_re_directory02.png" alt="linux mv 重命名文目录"></p><h3 id="打印移动信息"><a href="#打印移动信息" class="headerlink" title="打印移动信息"></a>打印移动信息</h3><p>当你移动或重命名一大堆文件或目录时，你可能会想在不去目标位置去查看的情况下知道自己的命令是否成功地执行了。这就用到-v选项了。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv -v  <span class="regexp">/home/</span>soruce_file2<span class="regexp">/*.txt /</span>home<span class="regexp">/destination_file/</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/linux_command/linux_mv/mv_v.png" alt="linux mv 打印移动信息"></p><h3 id="使用交互模式"><a href="#使用交互模式" class="headerlink" title="使用交互模式"></a>使用交互模式</h3><p>当你将文件移动到其他位置，而那个位置恰好有同样的文件，这时mv命令会覆盖掉原来的文件，对于mv的这一行为一般不会有什么提示。如果想产生一个关于覆盖文件的提示，我们可以使用-i选项。</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv -<span class="selector-tag">i</span> /home/soruce_file2/file_3<span class="selector-class">.txt</span> /home/destination_file/</span><br></pre></td></tr></table></figure><p>这个提示会让我们知道目标位置处file_3.txt的存在。如果我们按y键，那么那个文件将会被删除，否则不会</p><p><img src="/img/ubuntu/linux_command/linux_mv/mv_i.png" alt="linux mv 移动文件是否覆盖"></p><h3 id="使用更新选项"><a href="#使用更新选项" class="headerlink" title="使用更新选项"></a>使用更新选项</h3><p>-i 选项会提示我们关于覆盖文件的提示，而 -u 则只在源文件比目标文件新时才执行更新，如果目标文件比源文件新，则不会执行。让我们看一看下面的例子：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv -uv <span class="regexp">/home/</span>soruce_file2<span class="regexp">/*.txt /</span>home<span class="regexp">/destination_file/</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/linux_command/linux_mv/mv_u.png" alt="linux mv 移动文件最新是否覆盖"></p><h3 id="不要覆盖任何已存在的文件"><a href="#不要覆盖任何已存在的文件" class="headerlink" title="不要覆盖任何已存在的文件"></a>不要覆盖任何已存在的文件</h3><p>如果-i选项询问我们是否覆盖文件，那么-n选项将不会允许我么覆盖任何已存在的文件，</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv -vn <span class="regexp">/home/</span>soruce_file2<span class="regexp">/file_new_time2.txt  /</span>home<span class="regexp">/destination_file/</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/linux_command/linux_mv/rm_n.png" alt="linux mv 移动文件最新是否覆盖"></p><h3 id="复制时创建备份"><a href="#复制时创建备份" class="headerlink" title="复制时创建备份"></a>复制时创建备份</h3><p>默认情况下，移动文件将会覆盖已存在的目标文件。但是如果我们移动错了文件而目标文件已经被新的文件覆盖了，这时应该怎么办才好呢？-b选项可以办到，该选项会在新文件覆盖旧文件时将旧文件做备份。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv -bv <span class="regexp">/home/</span>soruce_file2<span class="regexp">/file_new_time2.txt  /</span>home<span class="regexp">/destination_file/</span></span><br></pre></td></tr></table></figure><p><img src="/img/ubuntu/linux_command/linux_mv/mv_b.png" alt="linux mv 移动文件并备份"></p><h3 id="无条件覆盖已经存在的文件"><a href="#无条件覆盖已经存在的文件" class="headerlink" title="无条件覆盖已经存在的文件"></a>无条件覆盖已经存在的文件</h3><p>覆盖已经存在的文件或目录，使用-f选项。如果同时指定了 -f 选项和 -i 或 -n 选项，则 -f 选项会覆盖它们——即不进行任何提示而覆盖。所以在使用此参数的时候，你要保持头脑清醒，知道自己在做什么。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv -f <span class="regexp">/home/</span>soruce_file2<span class="regexp">/file_new_time2.txt  /</span>home<span class="regexp">/destination_file/</span></span><br></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>移动文件和目录命令是Linux系统的基本命令。通常你可以通过man mv 或者 mv –help显示mv的手册页以了解更多详细信息。</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>YII2搭建后台并实现rbac权限控制</title>
      <link href="/2017/12/08/Yii2%E6%90%AD%E5%BB%BA%E5%90%8E%E5%8F%B0%E5%B9%B6%E5%AE%9E%E7%8E%B0rbac%E6%9D%83%E9%99%90%E6%8E%A7/"/>
      <url>/2017/12/08/Yii2%E6%90%AD%E5%BB%BA%E5%90%8E%E5%8F%B0%E5%B9%B6%E5%AE%9E%E7%8E%B0rbac%E6%9D%83%E9%99%90%E6%8E%A7/</url>
      <content type="html"><![CDATA[<h3 id="安装Yii2"><a href="#安装Yii2" class="headerlink" title="安装Yii2"></a>安装Yii2</h3><p>参考官网安装文档<br><a href="http://www.yiiframework.com/download" target="_blank" rel="noopener"><font color="red">yiiframework</font></a><br><a href="http://www.yiichina.com/download" target="_blank" rel="noopener"><font color="red">yiichina</font></a></p><h3 id="配置数据库"><a href="#配置数据库" class="headerlink" title="配置数据库"></a>配置数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">创建数据库： create database yii2advanced default charset utf8;</span><br><span class="line"></span><br><span class="line">修改common/config/main-local.php数据库配置</span><br><span class="line"></span><br><span class="line">        <span class="string">'db'</span> =&gt; [</span><br><span class="line">            <span class="string">'class'</span> =&gt; <span class="string">'yii\db\Connection'</span>,</span><br><span class="line">            <span class="string">'dsn'</span> =&gt; <span class="string">'mysql:host=localhost;dbname=yii2advanced'</span>,</span><br><span class="line">            <span class="string">'username'</span> =&gt; <span class="string">'root'</span>,</span><br><span class="line">            <span class="string">'password'</span> =&gt; <span class="string">'root'</span>,</span><br><span class="line">            <span class="string">'charset'</span> =&gt; <span class="string">'utf8'</span>,</span><br><span class="line">        ],</span><br></pre></td></tr></table></figure><p><img src="/img/Yii2/mysql_config.png" alt="数据配置"></p><h3 id="使用composer安装yii2-admin"><a href="#使用composer安装yii2-admin" class="headerlink" title="使用composer安装yii2-admin"></a>使用composer安装yii2-admin</h3><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">composer require mdmsoft/yii2-admin <span class="string">"~2.0"</span></span><br><span class="line"></span><br><span class="line">!!!温馨提示：建议安装 <span class="number">1.0</span> 版本不安装 <span class="number">2.0</span> 版本!!!</span><br><span class="line">composer require mdmsoft/yii2-admin <span class="string">"~1.0"</span></span><br></pre></td></tr></table></figure><h3 id="配置yii2-admin运行环境"><a href="#配置yii2-admin运行环境" class="headerlink" title="配置yii2-admin运行环境"></a>配置yii2-admin运行环境</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">权限控制在后台，所以在 backend/config/main.php 中配置以下内容：</span><br><span class="line"><span class="keyword">return</span> [</span><br><span class="line">    <span class="string">'modules'</span> =&gt; [</span><br><span class="line">        <span class="string">'admin'</span> =&gt; [</span><br><span class="line">            <span class="string">'class'</span> =&gt; <span class="string">'mdm\admin\Module'</span>,</span><br><span class="line">             <span class="string">'layout'</span> =&gt; <span class="string">'left-menu'</span>,<span class="comment">//yii2-admin的导航菜单</span></span><br><span class="line">        ]</span><br><span class="line">        ...</span><br><span class="line">    ],</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">'components'</span> =&gt; [</span><br><span class="line">        ...</span><br><span class="line">        <span class="string">'authManager'</span> =&gt; [</span><br><span class="line">            <span class="string">'class'</span> =&gt; <span class="string">'yii\rbac\DbManager'</span>, <span class="comment">// 使用数据库管理配置文件</span></span><br><span class="line">        ]</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">'as access'</span> =&gt; [</span><br><span class="line">        <span class="string">'class'</span> =&gt; <span class="string">'mdm\admin\components\AccessControl'</span>,</span><br><span class="line">        <span class="string">'allowActions'</span> =&gt; [</span><br><span class="line">            <span class="string">'site/*'</span>,<span class="comment">//允许访问的节点，可自行添加</span></span><br><span class="line">            <span class="string">'admin/*'</span>,<span class="comment">//允许所有人访问admin节点及其子节点</span></span><br><span class="line">        ]</span><br><span class="line">    ],</span><br><span class="line">];</span><br></pre></td></tr></table></figure><h3 id="创建数据表"><a href="#创建数据表" class="headerlink" title="创建数据表"></a>创建数据表</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">php yii migrate --migrationPath=@mdm/admin/migrations</span><br><span class="line"></span><br><span class="line">执行sql：（自带的rbac）  </span><br><span class="line">修改配置文件console/config/main-local.php</span><br><span class="line"><span class="built_in">return</span> [</span><br><span class="line">    <span class="string">'bootstrap'</span> =&gt; [<span class="string">'gii'</span>],</span><br><span class="line">    <span class="string">'modules'</span> =&gt; [</span><br><span class="line">        <span class="string">'gii'</span> =&gt; <span class="string">'yii\gii\Module'</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">'components'</span> =&gt; [</span><br><span class="line">        <span class="string">"authManager"</span> =&gt; [</span><br><span class="line">            <span class="string">"class"</span> =&gt; <span class="string">'yii\rbac\DbManager'</span>,</span><br><span class="line">            <span class="string">"defaultRoles"</span> =&gt; [<span class="string">"guest"</span>],</span><br><span class="line">        ],</span><br><span class="line">    ],</span><br><span class="line">];</span><br><span class="line"><span class="built_in">cd</span>到advance目录下面执行</span><br><span class="line">yii migrate --migrationPath=@yii/rbac/migrations</span><br></pre></td></tr></table></figure><h3 id="中文显示"><a href="#中文显示" class="headerlink" title="中文显示"></a>中文显示</h3><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">在 common\config\main.php 中配置</span><br><span class="line"></span><br><span class="line">return [</span><br><span class="line">    <span class="string">'language'</span> =&gt; <span class="string">'zh-CN'</span>, <span class="comment">//中文显示</span></span><br><span class="line">    <span class="string">'aliases'</span> =&gt; [</span><br><span class="line">        <span class="string">'@bower'</span> =&gt; <span class="string">'@vendor/bower-asset'</span>,</span><br><span class="line">        <span class="string">'@npm'</span>   =&gt; <span class="string">'@vendor/npm-asset'</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">'vendorPath'</span> =&gt; dirname(dirname(__DIR__)) . <span class="string">'/vendor'</span>,</span><br><span class="line">    <span class="string">'components'</span> =&gt; [</span><br><span class="line">        <span class="string">'cache'</span> =&gt; [</span><br><span class="line">            <span class="string">'class'</span> =&gt; <span class="string">'yii\caching\FileCache'</span>,</span><br><span class="line">        ],</span><br><span class="line">    ],</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">现在可以查看后台：</span><br><span class="line">&lt;Your domain <span class="keyword">name</span>&gt;/<span class="keyword">index</span>.php?r=admin/user</span><br><span class="line">&lt;Your domain <span class="keyword">name</span>&gt;/<span class="keyword">index</span>.php?r=admin</span><br><span class="line">&lt;Your domain <span class="keyword">name</span>&gt;/<span class="keyword">index</span>.php?r=admin/route</span><br><span class="line">&lt;Your domain <span class="keyword">name</span>&gt;/<span class="keyword">index</span>.php?r=admin/permission</span><br><span class="line">&lt;Your domain <span class="keyword">name</span>&gt;/<span class="keyword">index</span>.php?r=admin/menu</span><br><span class="line">&lt;Your domain <span class="keyword">name</span>&gt;/<span class="keyword">index</span>.php?r=admin/role</span><br><span class="line">&lt;Your domain <span class="keyword">name</span>&gt;/<span class="keyword">index</span>.php?r=admin/assignment</span><br></pre></td></tr></table></figure><p><img src="/img/Yii2/yii2_admin_install_end.png" alt="yii2-admin 安装完成"></p><h3 id="配置授权demo"><a href="#配置授权demo" class="headerlink" title="配置授权demo"></a>配置授权demo</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">以一个自定义的节点books为例，节点books下共有index 图书列表，view 查看图书，<span class="keyword">create</span>创建图书，<span class="keyword">update</span> 更新图书，<span class="keyword">delete</span> 删除图书这个<span class="number">5</span>个节点，，可以通过gii生成这些代码。</span><br><span class="line"></span><br><span class="line">配置目标：</span><br><span class="line">未登录用户仅能访问<span class="keyword">index</span>节点</span><br><span class="line">一般用户能访问<span class="keyword">index</span>，<span class="keyword">view</span>，<span class="keyword">create</span>三个节点</span><br><span class="line">管理员能访问所有节点</span><br><span class="line"><span class="comment">---------------------------</span></span><br><span class="line">在 backend/config/main.php 中修改配置以下内容：</span><br><span class="line">    <span class="string">'as access'</span> =&gt; [</span><br><span class="line">        <span class="string">'class'</span> =&gt; <span class="string">'mdm\admin\components\AccessControl'</span>,</span><br><span class="line">        <span class="string">'allowActions'</span> =&gt; [</span><br><span class="line">            //<span class="string">'site/*'</span>,//允许访问的节点，可自行添加</span><br><span class="line">            //<span class="string">'admin/*'</span>,//允许所有人访问<span class="keyword">admin</span>节点及其子节点</span><br><span class="line">            <span class="string">"*"</span>//不配置这个是访问不到gii，使用完记得修改回来，否则权限会出问题</span><br><span class="line">        ]</span><br><span class="line">    ],</span><br></pre></td></tr></table></figure><h3 id="添加可分配权限列表"><a href="#添加可分配权限列表" class="headerlink" title="添加可分配权限列表"></a>添加可分配权限列表</h3><p>在路由列表中，添加book各个节点路由由表添加至右侧可分配路由列表中，如下:</p><p><img src="/img/Yii2/book_route.png" alt="路由列表 图书"></p><p>在权限列表=》新增权限，填好后提交，然后填的路由规则即可，如下：</p><p><img src="/img/Yii2/authority_add_01.png" alt="权限列表 新增权限"></p><p><img src="/img/Yii2/authority_add_03.png" alt="权限列表 新增权限的对应路由"></p><p><img src="/img/Yii2/authority_add_04.png" alt="权限列表"></p><h3 id="添加角色并分配权限"><a href="#添加角色并分配权限" class="headerlink" title="添加角色并分配权限"></a>添加角色并分配权限</h3><p><img src="/img/Yii2/role_add_01.png" alt="角色列表 新增角色"></p><p><img src="/img/Yii2/role_add_02.png" alt="角色列表 新增角色对应的权限"></p><p><img src="/img/Yii2/role_add_03.png" alt="角色列表"></p><h3 id="分配角色"><a href="#分配角色" class="headerlink" title="分配角色"></a>分配角色</h3><p>手动注册用户，我这里注册admin和test进行测试。其中admin为管理员，test为一般用户</p><p><img src="/img/Yii2/register_user.png" alt="分配列表 00"></p><p><img src="/img/Yii2/assignments_list_01.png" alt="分配列表 list 01"></p><p><img src="/img/Yii2/assignments_list_02.png" alt="分配列表 add 02"></p><p><img src="/img/Yii2/assignments_list_03.png" alt="分配列表 add 03"></p><h2 id="！！！测试权限之前"><a href="#！！！测试权限之前" class="headerlink" title="！！！测试权限之前"></a><font color="red">！！！测试权限之前</font></h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">！！！ 测试权限之前，把这里注释掉</span><br><span class="line">在 backend<span class="regexp">/config/m</span>ain.php 中修改配置以下内容：</span><br><span class="line">    <span class="string">'as access'</span> =&gt; [</span><br><span class="line">        <span class="string">'class'</span> =&gt; <span class="string">'mdm\admin\components\AccessControl'</span>,</span><br><span class="line">        <span class="string">'allowActions'</span> =&gt; [</span><br><span class="line">            <span class="regexp">//</span><span class="string">'site/*'</span>,<span class="regexp">//</span>允许访问的节点，可自行添加</span><br><span class="line">            <span class="regexp">//</span><span class="string">'admin/*'</span>,<span class="regexp">//</span>允许所有人访问admin节点及其子节点</span><br><span class="line">            <span class="regexp">//</span><span class="string">"*"</span><span class="regexp">//</span>把这个注释掉！！！</span><br><span class="line">        ]</span><br><span class="line">    ],</span><br></pre></td></tr></table></figure><h3 id="开始测试"><a href="#开始测试" class="headerlink" title="开始测试"></a>开始测试</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、以管理员身份登录时，可以进行所有操作。ok</span><br><span class="line"><span class="number">2</span>、如果不登录，在访问book首页的时候会跳转到登录页面。预期结果是未登录时能访问book首页，就是说当前系统默认不认可我们配置给未登录用户的权限。</span><br><span class="line">有<span class="number">2</span>中办法</span><br><span class="line">第一种 在 backend<span class="regexp">/config/m</span>ain.php 中加一行指定默认规则的代码即可，如下：</span><br><span class="line"></span><br><span class="line"><span class="string">'authManager'</span>=&gt; [</span><br><span class="line">    <span class="string">'class'</span> =&gt; <span class="string">'yii\rbac\DbManager'</span>,</span><br><span class="line">    <span class="string">'defaultRoles'</span> =&gt; [<span class="string">'未登录用户'</span>],<span class="regexp">//</span>添加此行代码，指定默认规则为 <span class="string">'未登录用户'</span></span><br><span class="line">],</span><br><span class="line"></span><br><span class="line">或者在 backend<span class="regexp">/config/m</span>ain.php 修改为：</span><br><span class="line">    <span class="string">'as access'</span> =&gt; [</span><br><span class="line">        <span class="string">'class'</span> =&gt; <span class="string">'mdm\admin\components\AccessControl'</span>,</span><br><span class="line">        <span class="string">'allowActions'</span> =&gt; [</span><br><span class="line">            <span class="regexp">//</span><span class="string">'site/*'</span>,<span class="regexp">//</span>允许访问的节点，可自行添加</span><br><span class="line">            <span class="regexp">//</span><span class="string">'admin/*'</span>,<span class="regexp">//</span>允许所有人访问admin节点及其子节点</span><br><span class="line">            <span class="regexp">//</span><span class="string">"*"</span><span class="regexp">//</span>不配置这个是访问不到gii，使用完记得修改回来，否则权限会出问题</span><br><span class="line">            <span class="string">"book/index"</span>,<span class="regexp">//</span>未登录用户也可以访问图书列表</span><br><span class="line">        ]</span><br><span class="line">    ],</span><br></pre></td></tr></table></figure><h3 id="……"><a href="#……" class="headerlink" title="……"></a>……</h3><hr><h3 id="安装yii2-AdminLTE后台主题"><a href="#安装yii2-AdminLTE后台主题" class="headerlink" title="安装yii2 AdminLTE后台主题"></a>安装yii2 AdminLTE后台主题</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">composer <span class="built_in">require</span> dmstr/yii2-adminlte-asset <span class="string">"^2.1"</span></span><br><span class="line"></span><br><span class="line">安装过程中可能需要输入github的<span class="keyword">token</span></span><br></pre></td></tr></table></figure><h3 id="引入主题"><a href="#引入主题" class="headerlink" title="引入主题"></a>引入主题</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">方式一：(建议使用这种方式)</span><br><span class="line">复制整个vendor/dmstr/yii2-adminlte-asset/example-views/yiisoft/yii2-app目录下的layouts目录和site目录到backend/views，覆盖原始文件。</span><br><span class="line"></span><br><span class="line">方式二：</span><br><span class="line"><span class="string">'components'</span> =&gt; [</span><br><span class="line">    <span class="string">'view'</span> =&gt; [</span><br><span class="line">         <span class="string">'theme'</span> =&gt; [</span><br><span class="line">             <span class="string">'pathMap'</span> =&gt; [</span><br><span class="line">                <span class="string">'@app/views'</span> =&gt; <span class="string">'@vendor/dmstr/yii2-adminlte-asset/example-views/yiisoft/yii2-app'</span></span><br><span class="line">             ],</span><br><span class="line">         ],</span><br><span class="line">    ],</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line">现在可以查看后台：</span><br><span class="line">&lt;Your domain name&gt;/index.php?r=admin%<span class="number">2</span>Fuser</span><br><span class="line">！！！如果访问权限相关的路径，如/admin/route/index并不是上面看到的样式，请将配置文件中的modules数组中配置的layouts的值删掉即可。如下：</span><br><span class="line">        <span class="string">'admin'</span> =&gt; [</span><br><span class="line">            <span class="string">'class'</span> =&gt; <span class="string">'mdm\admin\Module'</span>,</span><br><span class="line">            <span class="comment">//'layout' =&gt; 'left-menu',//yii2-admin的导航菜单</span></span><br><span class="line">        ]</span><br></pre></td></tr></table></figure><p><img src="/img/Yii2/yii2_adminlte_install_end.png" alt="yii2-adminlte 安装完成"></p><h3 id="配置数据库，登录"><a href="#配置数据库，登录" class="headerlink" title="配置数据库，登录"></a>配置数据库，登录</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、修改common/config/main-local.php数据库配置</span><br><span class="line"></span><br><span class="line">        <span class="string">'db'</span> =&gt; [</span><br><span class="line">            <span class="string">'class'</span> =&gt; <span class="string">'yii\db\Connection'</span>,</span><br><span class="line">            <span class="string">'dsn'</span> =&gt; <span class="string">'mysql:host=localhost;dbname=yii2advanced'</span>,</span><br><span class="line">            <span class="string">'username'</span> =&gt; <span class="string">'root'</span>,</span><br><span class="line">            <span class="string">'password'</span> =&gt; <span class="string">'root'</span>,</span><br><span class="line">            <span class="string">'charset'</span> =&gt; <span class="string">'utf8'</span>,</span><br><span class="line">        ],</span><br><span class="line"><span class="number">2</span>、注册后台账户，登录     </span><br><span class="line"></span><br><span class="line"><span class="number">3</span>、在 common\config\main.php 中配置</span><br><span class="line"><span class="keyword">return</span> [</span><br><span class="line">    <span class="string">'language'</span> =&gt; <span class="string">'zh-CN'</span>, <span class="comment">//中文显示</span></span><br><span class="line">    <span class="string">'aliases'</span> =&gt; [</span><br><span class="line">        <span class="string">'@bower'</span> =&gt; <span class="string">'@vendor/bower-asset'</span>,</span><br><span class="line">        <span class="string">'@npm'</span>   =&gt; <span class="string">'@vendor/npm-asset'</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">'vendorPath'</span> =&gt; dirname(dirname(<span class="keyword">__DIR__</span>)) . <span class="string">'/vendor'</span>,</span><br><span class="line">    <span class="string">'components'</span> =&gt; [</span><br><span class="line">        <span class="string">'cache'</span> =&gt; [</span><br><span class="line">            <span class="string">'class'</span> =&gt; <span class="string">'yii\caching\FileCache'</span>,</span><br><span class="line">        ],</span><br><span class="line">    ],</span><br><span class="line">];</span><br></pre></td></tr></table></figure><h3 id="配置简短路由"><a href="#配置简短路由" class="headerlink" title="配置简短路由"></a>配置简短路由</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">在 backend/config/main.php文件的compontents加上下面的配置</span><br><span class="line"><span class="string">"urlManager"</span> =&gt; [    </span><br><span class="line">    <span class="comment">//用于表明urlManager是否启用URL美化功能，在Yii1.1中称为path格式URL，    </span></span><br><span class="line">    <span class="comment">// Yii2.0中改称美化。   </span></span><br><span class="line">    <span class="comment">// 默认不启用。但实际使用中，特别是产品环境，一般都会启用。   </span></span><br><span class="line">    <span class="string">"enablePrettyUrl"</span> =&gt; <span class="keyword">true</span>,    </span><br><span class="line">    <span class="comment">// 是否启用严格解析，如启用严格解析，要求当前请求应至少匹配1个路由规则，    </span></span><br><span class="line">    <span class="comment">// 否则认为是无效路由。    </span></span><br><span class="line">    <span class="comment">// 这个选项仅在 enablePrettyUrl 启用后才有效。    </span></span><br><span class="line">    <span class="string">"enableStrictParsing"</span> =&gt; <span class="keyword">false</span>,    </span><br><span class="line">    <span class="comment">// 是否在URL中显示入口脚本。是对美化功能的进一步补充。    </span></span><br><span class="line">    <span class="string">"showScriptName"</span> =&gt; <span class="keyword">false</span>,    </span><br><span class="line">    <span class="comment">// 指定续接在URL后面的一个后缀，如 .html 之类的。仅在 enablePrettyUrl 启用时有效。    </span></span><br><span class="line">    <span class="string">"suffix"</span> =&gt; <span class="string">""</span>,    </span><br><span class="line">    <span class="string">"rules"</span> =&gt; [        </span><br><span class="line">        <span class="string">"&lt;controller:\w+&gt;/&lt;id:\d+&gt;"</span>=&gt;<span class="string">"&lt;controller&gt;/view"</span>,  </span><br><span class="line">        <span class="string">"&lt;controller:\w+&gt;/&lt;action:\w+&gt;"</span>=&gt;<span class="string">"&lt;controller&gt;/&lt;action&gt;"</span>    </span><br><span class="line">    ],</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line">配置web server</span><br><span class="line">Apache作为服务器，在应用的目录 backend/web下面创建.htaccess文件并添加如下内容：</span><br><span class="line">Options +FollowSymLinks</span><br><span class="line">IndexIgnore  *<span class="comment">/*</span></span><br><span class="line"><span class="comment">RewriteEngine on</span></span><br><span class="line"><span class="comment"># if a directory or a file exists, use it directly</span></span><br><span class="line"><span class="comment">RewriteCond  %&#123;REQUEST_FILENAME&#125; !-f</span></span><br><span class="line"><span class="comment">RewriteCond %&#123;REQUEST_FILENAME&#125; !-d</span></span><br><span class="line"><span class="comment"># otherwise forward it to index.php</span></span><br><span class="line"><span class="comment">RewriteRule . index.php</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">nginx用户，修改server部分，如下：</span></span><br><span class="line"><span class="comment">server &#123;</span></span><br><span class="line"><span class="comment">    listen       80;</span></span><br><span class="line"><span class="comment">    server_name  yourdomain;</span></span><br><span class="line"><span class="comment">    root yourdirectory/backend/web;</span></span><br><span class="line"><span class="comment">    index  index.php index.html;</span></span><br><span class="line"><span class="comment">    charset utf-8;</span></span><br><span class="line"><span class="comment">    location / &#123;</span></span><br><span class="line"><span class="comment">        index  index.php;</span></span><br><span class="line"><span class="comment">        if (!-e $request_filename) &#123;</span></span><br><span class="line"><span class="comment">            rewrite  ^(.*)$  /index.php/$1  last;</span></span><br><span class="line"><span class="comment">            break;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    location ~ .+\.php($|/) &#123;</span></span><br><span class="line"><span class="comment">        fastcgi_pass 127.0.0.1:9000;</span></span><br><span class="line"><span class="comment">        fastcgi_index index.php;</span></span><br><span class="line"><span class="comment">        include fastcgi.conf;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="启动更多分配路由"><a href="#启动更多分配路由" class="headerlink" title="启动更多分配路由"></a>启动更多分配路由</h3><p>我们先访问路由页面 /admin/route ，尽可能的把左侧的全部选中，然后移动到右侧，并记得给当前用户分配相关的可访问权限。</p><p><img src="/img/Yii2/adminLTE_route_all.png" alt="yii2-adminlte 所有路由"></p><h3 id="添加菜单"><a href="#添加菜单" class="headerlink" title="添加菜单"></a>添加菜单</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">访问菜单列表 admin/menu 点击添加菜单admin/menu/create按钮。</span><br><span class="line">&gt; 如果这个时候你没有权限访问了，需要在配置文件（backend/config/main.php）的 <span class="keyword">as</span> access数组暂时允许当前用户访问任意权限，并在我们添加完权限的时候去掉<span class="keyword">as</span> access的设置，切记。</span><br><span class="line">    <span class="string">'as access'</span> =&gt; [</span><br><span class="line">        <span class="string">'class'</span> =&gt; <span class="string">'mdm\admin\components\AccessControl'</span>,</span><br><span class="line">        <span class="string">'allowActions'</span> =&gt; [</span><br><span class="line">            <span class="comment">//'site/*',//允许访问的节点，可自行添加</span></span><br><span class="line">            <span class="comment">//'admin/*',//允许所有人访问admin节点及其子节点</span></span><br><span class="line">            <span class="string">"*"</span><span class="comment">//不配置这个是访问不到gii，使用完记得修改回来，否则权限会出问题</span></span><br><span class="line">            <span class="comment">//"book/index",//未登录用户也可以访问图书列表</span></span><br><span class="line">        ]</span><br><span class="line">    ],</span><br><span class="line">    </span><br><span class="line">？？？？？？？？？父级一直添加不上？？？先手动修改数据库？？？？最后解决这个问题？？？？    </span><br><span class="line">添加界面如下：</span><br></pre></td></tr></table></figure><p><img src="/img/Yii2/adminLTE_menu_add_01.png" alt="yii2-adminlte 添加菜单01"></p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">一、例如添加一级菜单<span class="string">"权限管理"</span>，按照如下填写：</span><br><span class="line">名称：权限管理</span><br><span class="line">父级名称：不填</span><br><span class="line">路由：/admin/<span class="keyword">default</span>/<span class="keyword">index</span></span><br><span class="line">排序：<span class="number">1</span></span><br><span class="line">数据：暂不填写</span><br><span class="line"></span><br><span class="line">二、添加一个二级菜单<span class="string">"角色列表"</span>，如下：</span><br><span class="line">名称：角色列表</span><br><span class="line">父级名称：权限管理</span><br><span class="line">路由：/admin/role/<span class="keyword">index</span></span><br><span class="line">排序：<span class="number">2</span></span><br><span class="line">数据：暂不填写</span><br><span class="line"></span><br><span class="line">三、添加一个二级菜单<span class="string">"权限列表"</span>，如下：</span><br><span class="line">名称：权限列表</span><br><span class="line">父级名称：权限管理</span><br><span class="line">路由：/admin/permission/<span class="keyword">index</span></span><br><span class="line">排序：<span class="number">3</span></span><br><span class="line">数据：暂不填写</span><br><span class="line"></span><br><span class="line">四、添加一个二级菜单<span class="string">"路由列表"</span>，如下：</span><br><span class="line">名称：路由列表</span><br><span class="line">父级名称：权限管理</span><br><span class="line">路由：/admin/route/<span class="keyword">index</span></span><br><span class="line">排序：<span class="number">4</span></span><br><span class="line">数据：暂不填写</span><br><span class="line"></span><br><span class="line">五、添加一个二级菜单<span class="string">"规则管理"</span>，如下：</span><br><span class="line">名称：规则管理</span><br><span class="line">父级名称：权限管理</span><br><span class="line">路由：/admin/rule/<span class="keyword">index</span></span><br><span class="line">排序：<span class="number">5</span></span><br><span class="line">数据：暂不填写</span><br><span class="line"></span><br><span class="line">六、添加一个二级菜单<span class="string">"分配用户到角色"</span>，如下：</span><br><span class="line">名称：分配用户到角色</span><br><span class="line">父级名称：权限管理</span><br><span class="line">路由：/admin/assignment/<span class="keyword">index</span></span><br><span class="line">排序：<span class="number">6</span></span><br><span class="line">数据：暂不填写</span><br><span class="line"></span><br><span class="line">七、添加一个二级菜单<span class="string">"菜单列表"</span>，如下：</span><br><span class="line">名称：菜单列表</span><br><span class="line">父级名称：权限管理</span><br><span class="line">路由：/admin/menu/<span class="keyword">index</span></span><br><span class="line">排序：<span class="number">7</span></span><br><span class="line">数据：暂不填写</span><br><span class="line"></span><br><span class="line">八、添加一个二级菜单<span class="string">"用户列表"</span>，如下：</span><br><span class="line">名称：用户列表</span><br><span class="line">父级名称：权限管理</span><br><span class="line">路由：/admin/user/<span class="keyword">index</span></span><br><span class="line">排序：<span class="number">8</span></span><br><span class="line">数据：暂不填写</span><br><span class="line"></span><br><span class="line">九、添加一个二级菜单<span class="string">"图书列表"</span>，如下：</span><br><span class="line">名称：图书列表</span><br><span class="line">父级名称：权限管理</span><br><span class="line">路由：/book/<span class="keyword">index</span></span><br><span class="line">排序：<span class="number">9</span></span><br><span class="line">数据：暂不填写</span><br><span class="line"></span><br><span class="line">具体如下</span><br></pre></td></tr></table></figure><p><img src="/img/Yii2/adminLTE_menu_add_02.png" alt="yii2-adminlte 添加菜单02"></p><h3 id="左侧菜单展示"><a href="#左侧菜单展示" class="headerlink" title="左侧菜单展示"></a>左侧菜单展示</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">修改</span><br><span class="line">&lt;project&gt;/backend/views/layouts/left.php</span><br><span class="line">文件（保证这个文件是从</span><br><span class="line">&lt;project&gt;/vendor/dmstr/yii2-adminlte-asset/example-views/yiisoft/yii2-app/views/layouts/left.php</span><br><span class="line">地方复制过来的，否则去修改源文件），添加如下代码：</span><br><span class="line">侧菜单上把权限的栏目加上,代码可直接复制，放置于 &lt;section class=<span class="string">"sidebar"</span>&gt;&lt;/section&gt;标签内即可</span><br><span class="line"></span><br><span class="line">        //第一种显示方式</span><br><span class="line">        <span class="variable">$callback</span> = <span class="keyword">function</span>(<span class="variable">$menu</span>)&#123;</span><br><span class="line">            <span class="built_in">return</span> [</span><br><span class="line">                <span class="string">'label'</span> =&gt; <span class="variable">$menu</span>[<span class="string">'name'</span>],</span><br><span class="line">                <span class="string">'url'</span> =&gt; [<span class="variable">$menu</span>[<span class="string">'route'</span>]],</span><br><span class="line">                <span class="string">'icon'</span> =&gt; <span class="variable">$menu</span>[<span class="string">'data'</span>],</span><br><span class="line">                <span class="string">'items'</span> =&gt; <span class="variable">$menu</span>[<span class="string">'children'</span>]</span><br><span class="line">            ];</span><br><span class="line">        &#125;;</span><br><span class="line">        use mdm\admin\components\MenuHelper;</span><br><span class="line">        <span class="variable">$items</span> = MenuHelper::getAssignedMenu(Yii::<span class="variable">$app</span>-&gt;user-&gt;id, null, <span class="variable">$callback</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="built_in">echo</span> dmstr\widgets\Menu::widget([</span><br><span class="line">            <span class="string">'options'</span> =&gt; [<span class="string">'class'</span> =&gt; <span class="string">'sidebar-menu'</span>, <span class="string">'data-widget'</span>=&gt; <span class="string">'tree'</span>],</span><br><span class="line">            <span class="string">'items'</span> =&gt; <span class="variable">$items</span></span><br><span class="line">        ]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        //第二种显示方式</span><br><span class="line">        //use mdm\admin\components\MenuHelper;</span><br><span class="line">        use yii\bootstrap\Nav;</span><br><span class="line">        <span class="built_in">echo</span> Nav::widget(</span><br><span class="line">            [</span><br><span class="line">                //<span class="string">"encodeLabels"</span> =&gt; <span class="literal">false</span>,</span><br><span class="line">                <span class="string">"options"</span> =&gt; [<span class="string">"class"</span> =&gt; <span class="string">"sidebar-menu"</span>, <span class="string">'data-widget'</span>=&gt; <span class="string">'tree'</span>],</span><br><span class="line">                <span class="string">"items"</span> =&gt; MenuHelper::getAssignedMenu(Yii::<span class="variable">$app</span>-&gt;user-&gt;id),</span><br><span class="line">            ]</span><br><span class="line">        );</span><br></pre></td></tr></table></figure><p><img src="/img/Yii2/adminLTE_left.png" alt="yii2-adminlte 左侧菜单"></p><h3 id="整合完毕后存在问题（原因是-yii2-admin-2-0版本）"><a href="#整合完毕后存在问题（原因是-yii2-admin-2-0版本）" class="headerlink" title="整合完毕后存在问题（原因是 yii2-admin 2.0版本）"></a>整合完毕后存在问题（原因是 yii2-admin 2.0版本）</h3><p>一、菜单小图标并控制菜单显示：<br>我们在创建菜单的时候，没填写的”数据”一栏，我们填写 <a href="http://www.runoob.com/font-awesome/fontawesome-tutorial.html" target="_blank" rel="noopener"><font color="red">Font Awesome</font></a> 从这里面选择图标，例如在品牌图标中 使用这个是    fa fa-android  ；我们在 菜单“数据”一栏应该写 android，如图：<br><img src="/img/Yii2/bug_menu_icon.png" alt="bug 图标填写错误"></p><p>二、菜单列表中父级一直添加不上 ，父级名意图提示样式会跑到最左侧，路由意图样式会跑到最左侧（yii2-admin 版本1.0没有此问题）<br><img src="/img/Yii2/bug_menu_add_menu.png" alt="bug 新增菜单样式错误"></p><p>解决办法：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">一、解决父级添加不上：</span><br><span class="line">修改&lt;project&gt;/vendor/mdmsoft/yii2-admin/models/Menu.php中</span><br><span class="line">原来：</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">rules</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            [[<span class="string">'name'</span>], <span class="string">'required'</span>],</span><br><span class="line">            [[<span class="string">'parent_name'</span>], <span class="string">'in'</span>,</span><br><span class="line">                <span class="string">'range'</span> =&gt; <span class="keyword">static</span>::find()-&gt;select([<span class="string">'name'</span>])-&gt;column(),</span><br><span class="line">                <span class="string">'message'</span> =&gt; <span class="string">'Menu "&#123;value&#125;" not found.'</span>],</span><br><span class="line">            [[<span class="string">'parent'</span>, <span class="string">'route'</span>, <span class="string">'data'</span>, <span class="string">'order'</span>], <span class="string">'default'</span>],</span><br><span class="line">            [[<span class="string">'parent'</span>], <span class="string">'filterParent'</span>, <span class="string">'when'</span> =&gt; <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> !<span class="keyword">$this</span>-&gt;isNewRecord;</span><br><span class="line">            &#125;], </span><br><span class="line">            [[<span class="string">'order'</span>], <span class="string">'integer'</span>],</span><br><span class="line">            [[<span class="string">'route'</span>], <span class="string">'in'</span>,</span><br><span class="line">                <span class="string">'range'</span> =&gt; <span class="keyword">static</span>::getSavedRoutes(),</span><br><span class="line">                <span class="string">'message'</span> =&gt; <span class="string">'Route "&#123;value&#125;" not found.'</span>]</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line">    修改后：</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">rules</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            [[<span class="string">'name'</span>], <span class="string">'required'</span>],</span><br><span class="line">            [[<span class="string">'parent_name'</span>], <span class="string">'in'</span>,</span><br><span class="line">                <span class="string">'range'</span> =&gt; <span class="keyword">static</span>::find()-&gt;select([<span class="string">'name'</span>])-&gt;column(),</span><br><span class="line">                <span class="string">'message'</span> =&gt; <span class="string">'Menu "&#123;value&#125;" not found.'</span>],</span><br><span class="line">            [[<span class="string">'parent'</span>, <span class="string">'route'</span>, <span class="string">'data'</span>, <span class="string">'order'</span>], <span class="string">'default'</span>],</span><br><span class="line">            <span class="comment">/*[['parent'], 'filterParent', 'when' =&gt; function() &#123;</span></span><br><span class="line"><span class="comment">                return !$this-&gt;isNewRecord;</span></span><br><span class="line"><span class="comment">            &#125;],*/</span></span><br><span class="line">            [[<span class="string">'parent_name'</span>], <span class="string">'filterParent'</span>],<span class="comment">//修改此方法</span></span><br><span class="line">            [[<span class="string">'order'</span>], <span class="string">'integer'</span>],</span><br><span class="line">            [[<span class="string">'route'</span>], <span class="string">'in'</span>,</span><br><span class="line">                <span class="string">'range'</span> =&gt; <span class="keyword">static</span>::getSavedRoutes(),</span><br><span class="line">                <span class="string">'message'</span> =&gt; <span class="string">'Route "&#123;value&#125;" not found.'</span>]</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    原来：</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filterParent</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $parent = <span class="keyword">$this</span>-&gt;parent;</span><br><span class="line">        $db = <span class="keyword">static</span>::getDb();</span><br><span class="line">        $query = (<span class="keyword">new</span> Query)-&gt;select([<span class="string">'parent'</span>])</span><br><span class="line">            -&gt;from(<span class="keyword">static</span>::tableName())</span><br><span class="line">            -&gt;where(<span class="string">'[[id]]=:id'</span>);</span><br><span class="line">        <span class="keyword">while</span> ($parent) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;id == $parent) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;addError(<span class="string">'parent_name'</span>, <span class="string">'Loop detected.'</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            $parent = $query-&gt;params([<span class="string">':id'</span> =&gt; $parent])-&gt;scalar($db);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    修改后：</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filterParent</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//修改此方法</span></span><br><span class="line">        $value = <span class="keyword">$this</span>-&gt;parent_name;</span><br><span class="line">        $parent = <span class="keyword">self</span>::findOne([<span class="string">'name'</span> =&gt; $value]);</span><br><span class="line">        <span class="keyword">if</span> ($parent) &#123;</span><br><span class="line">            $id = <span class="keyword">$this</span>-&gt;id;</span><br><span class="line">            $parent_id = $parent-&gt;id;</span><br><span class="line">            <span class="keyword">while</span> ($parent) &#123;</span><br><span class="line">                <span class="keyword">if</span> ($parent-&gt;id == $id) &#123;</span><br><span class="line">                    <span class="keyword">$this</span>-&gt;addError(<span class="string">'parent_name'</span>, <span class="string">'Loop detected.'</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                $parent = $parent-&gt;menuParent;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parent = $parent_id;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">二、解决意图提示样式</span><br><span class="line">下载 yiisoft/yii2-jui</span><br><span class="line">php composer.phar <span class="keyword">require</span> --prefer-dist yiisoft/yii2-jui</span><br><span class="line"></span><br><span class="line">现在已经可以上试试效果，完全没有问题，如果不想用form中原来的书写方式可以按下面的办法；</span><br><span class="line">修改 &lt;project&gt;/vendor/mdmsoft/yii2-admin/views/menu/_form.php中parent_name和route表单：</span><br><span class="line">修改之前：</span><br><span class="line">            <span class="meta">&lt;?</span>= $form-&gt;field($model, <span class="string">'parent_name'</span>)-&gt;textInput([<span class="string">'id'</span> =&gt; <span class="string">'parent_name'</span>]) <span class="meta">?&gt;</span></span><br><span class="line">            <span class="meta">&lt;?</span>= $form-&gt;field($model, <span class="string">'route'</span>)-&gt;textInput([<span class="string">'id'</span> =&gt; <span class="string">'route'</span>]) <span class="meta">?&gt;</span></span><br><span class="line">修改之后：</span><br><span class="line">            <span class="meta">&lt;?</span>= $form-&gt;field($model, <span class="string">'parent_name'</span>)-&gt;widget(<span class="string">'yii\jui\AutoComplete'</span>,[</span><br><span class="line">                <span class="string">'options'</span>=&gt;[<span class="string">'class'</span>=&gt;<span class="string">'form-control'</span>],</span><br><span class="line">                <span class="string">'clientOptions'</span>=&gt;[</span><br><span class="line">                    <span class="string">'source'</span>=&gt;  Menu::find()-&gt;select([<span class="string">'name'</span>])-&gt;column()</span><br><span class="line">                ]</span><br><span class="line">            ]) <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="meta">&lt;?</span>= $form-&gt;field($model, <span class="string">'route'</span>)-&gt;widget(<span class="string">'yii\jui\AutoComplete'</span>,[</span><br><span class="line">                <span class="string">'options'</span>=&gt;[<span class="string">'class'</span>=&gt;<span class="string">'form-control'</span>],</span><br><span class="line">                <span class="string">'clientOptions'</span>=&gt;[</span><br><span class="line">                    <span class="string">'source'</span>=&gt; Menu::getSavedRoutes()</span><br><span class="line">                ]</span><br><span class="line">            ]) <span class="meta">?&gt;</span></span><br><span class="line">三、在 &lt;project&gt;/vendor/mdmsoft/yii2-admin/views/role/_form.php 同样会有样式问题，按照二的步骤修改即可</span><br><span class="line">   使用到的时候再改就可以。</span><br><span class="line">   修改后的：</span><br><span class="line">   <span class="meta">&lt;?</span>=</span><br><span class="line">    $form-&gt;field($model, <span class="string">'ruleName'</span>)-&gt;widget(<span class="string">'yii\jui\AutoComplete'</span>, [</span><br><span class="line">        <span class="string">'options'</span> =&gt; [</span><br><span class="line">            <span class="string">'class'</span> =&gt; <span class="string">'form-control'</span>,</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">'clientOptions'</span> =&gt; [</span><br><span class="line">            <span class="string">'source'</span> =&gt; array_keys(Yii::$app-&gt;authManager-&gt;getRules()),</span><br><span class="line">        ]</span><br><span class="line">    ])</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/img/Yii2/bug_menu_add_menu_ok_01.png" alt="bug 新增菜单父级改好1"></p><p><img src="/img/Yii2/bug_menu_add_menu_ok_02.png" alt="bug 新增菜单父级改好2"></p><p><img src="/img/Yii2/bug_menu_add_menu_ok_03.png" alt="bug 新增菜单父级改好3"></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>hexo常用命令笔记</title>
      <link href="/2017/11/30/hexo/hexo%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E7%AC%94%E8%AE%B0/"/>
      <url>/2017/11/30/hexo/hexo%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E7%AC%94%E8%AE%B0/</url>
      <content type="html"><![CDATA[<h3 id="hexo"><a href="#hexo" class="headerlink" title="hexo"></a>hexo</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo -g <span class="comment">#安装  </span></span><br><span class="line">npm update hexo -g <span class="comment">#升级  </span></span><br><span class="line">hexo init <span class="comment">#初始化</span></span><br></pre></td></tr></table></figure><h3 id="简写"><a href="#简写" class="headerlink" title="简写"></a>简写</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hexo n <span class="string">"我的博客"</span> == hexo new <span class="string">"我的博客"</span> <span class="comment">#新建文章</span></span><br><span class="line">hexo p == hexo publish</span><br><span class="line">hexo g == hexo generate<span class="comment">#生成</span></span><br><span class="line">hexo s == hexo server <span class="comment">#启动服务预览</span></span><br><span class="line">hexo d == hexo deploy<span class="comment">#部署</span></span><br></pre></td></tr></table></figure><h3 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hexo server <span class="comment">#Hexo 会监视文件变动并自动更新，您无须重启服务器。</span></span><br><span class="line">hexo server -s <span class="comment">#静态模式</span></span><br><span class="line">hexo server -p 5000 <span class="comment">#更改端口</span></span><br><span class="line">hexo server -i 192.168.1.1 <span class="comment">#自定义 IP</span></span><br><span class="line">hexo clean <span class="comment">#清除缓存 网页正常情况下可以忽略此条命令</span></span><br><span class="line">hexo g <span class="comment">#生成静态网页</span></span><br><span class="line">hexo d <span class="comment">#开始部署</span></span><br></pre></td></tr></table></figure><h3 id="监视文件变动"><a href="#监视文件变动" class="headerlink" title="监视文件变动"></a>监视文件变动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hexo generate <span class="comment">#使用 Hexo 生成静态文件快速而且简单</span></span><br><span class="line">hexo generate --watch <span class="comment">#监视文件变动</span></span><br><span class="line"></span><br><span class="line">完成后部署</span><br><span class="line">两个命令的作用是相同的</span><br><span class="line">hexo generate --deploy</span><br><span class="line">hexo deploy --generate</span><br><span class="line">hexo deploy -g</span><br><span class="line">hexo server -g</span><br></pre></td></tr></table></figure><h3 id="草稿"><a href="#草稿" class="headerlink" title="草稿"></a>草稿</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo publish [layout] &lt;title&gt;</span><br></pre></td></tr></table></figure><h3 id="模版"><a href="#模版" class="headerlink" title="模版"></a>模版</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hexo new <span class="string">"postName"</span> <span class="comment">#新建文章</span></span><br><span class="line">hexo new page <span class="string">"pageName"</span> <span class="comment">#新建页面</span></span><br><span class="line">hexo generate <span class="comment">#生成静态页面至public目录</span></span><br><span class="line">hexo server <span class="comment">#开启预览访问端口（默认端口4000，'ctrl + c'关闭server）</span></span><br><span class="line">hexo deploy <span class="comment">#将.deploy目录部署到GitHub</span></span><br><span class="line"></span><br><span class="line">hexo new [layout] &lt;title&gt;</span><br><span class="line">hexo new photo <span class="string">"My Gallery"</span></span><br><span class="line">hexo new <span class="string">"Hello World"</span> --lang tw</span><br></pre></td></tr></table></figure><table><thead><tr><th>变量</th><th style="text-align:right">描述</th></tr></thead><tbody><tr><td>layout</td><td style="text-align:right">布局</td></tr><tr><td>title</td><td style="text-align:right">标题</td></tr><tr><td>date</td><td style="text-align:right">建立</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">title: 使用Hexo搭建个人博客</span><br><span class="line">layout: post</span><br><span class="line">date: 2014-03-03 19:07:43</span><br><span class="line">comments: <span class="literal">true</span></span><br><span class="line">categories: Blog</span><br><span class="line">tags: [Hexo]</span><br><span class="line">keywords: Hexo, Blog</span><br><span class="line">description: 暮色匆匆去，音消尘也无</span><br><span class="line">模版（Scaffold）</span><br><span class="line">hexo new photo <span class="string">"My Gallery"</span></span><br></pre></td></tr></table></figure><h3 id="设置文章摘要"><a href="#设置文章摘要" class="headerlink" title="设置文章摘要"></a>设置文章摘要</h3><p>以上是文章摘要 以下是余下全文 </p><h3 id="写作"><a href="#写作" class="headerlink" title="写作"></a>写作</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo new page &lt;title&gt;</span><br><span class="line">hexo new post &lt;title&gt;</span><br></pre></td></tr></table></figure><table><thead><tr><th>变量</th><th>描述</th></tr></thead><tbody><tr><td>:title</td><td>标题</td></tr><tr><td>:year</td><td>建立的年份（4 位数）</td></tr><tr><td>:month</td><td>建立的月份（2 位数）</td></tr><tr><td>:i_month</td><td>建立的月份（去掉开头的零）</td></tr><tr><td>:day</td><td>建立的日期（2 位数）</td></tr><tr><td>:i_day</td><td>建立的日期（去掉开头的零）</td></tr></tbody></table><h3 id="推送到服务器上"><a href="#推送到服务器上" class="headerlink" title="推送到服务器上"></a>推送到服务器上</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo n <span class="comment">#写文章</span></span><br><span class="line">hexo g <span class="comment">#生成</span></span><br><span class="line">hexo d <span class="comment">#部署 #可与hexo g合并为 hexo d -g</span></span><br></pre></td></tr></table></figure><h3 id="报错"><a href="#报错" class="headerlink" title="报错"></a>报错</h3><p>1.找不到git部署</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR Deployer not found: git</span><br></pre></td></tr></table></figure><p>解决方法</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><p>3.部署类型设置git<br>hexo 3.0 部署类型不再是github，<code>_config.yml</code> 中修改</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: http://hexo.io/docs/deployment.html</span></span><br><span class="line">deploy:</span><br><span class="line"><span class="built_in">type</span>: git</span><br><span class="line">repository: git@***.github.com:***/***.github.io.git</span><br><span class="line">branch: master</span><br></pre></td></tr></table></figure><ol><li>xcodebuild</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xcode-select: error: tool <span class="string">'xcodebuild'</span> requires Xcode, but active developer directory <span class="string">'/Library/Developer/CommandLineTools'</span> is a <span class="built_in">command</span> line tools instance</span><br><span class="line"></span><br><span class="line">npm install bcrypt</span><br></pre></td></tr></table></figure><ol><li>RSS不显示<br>安装RSS插件</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-generator-feed --save</span><br></pre></td></tr></table></figure><h3 id="开启RSS功能"><a href="#开启RSS功能" class="headerlink" title="开启RSS功能"></a>开启RSS功能</h3><p>编辑<code>hexo/_config.yml</code>，添加如下代码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rss: /atom.xml <span class="comment">#rss地址  默认即可</span></span><br></pre></td></tr></table></figure><h3 id="开启评论"><a href="#开启评论" class="headerlink" title="开启评论"></a>开启评论</h3><p>1.我使用多说代替自带的评论，在多说 网站注册 &gt; 后台管理 &gt; 添加新站点 &gt; 工具 === 复制通用代码 里面有 short_name</p><p>1 在根目录 <code>_config.yml</code> 添加一行 <code>disqus_shortname: jslite</code> 是在多说注册时产生的<br>复制到 <code>themes\landscape\layout\_partial\article.ejs</code><br>2 把</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;% <span class="keyword">if</span> (!index &amp;&amp; post.comments &amp;&amp; config.disqus_shortname)&#123; %&gt;</span><br><span class="line">&lt;section id=<span class="string">"comments"</span>&gt;</span><br><span class="line">&lt;div id=<span class="string">"disqus_thread"</span>&gt;</span><br><span class="line">  &lt;noscript&gt;Please <span class="built_in">enable</span> JavaScript to view the &lt;a href=<span class="string">"//disqus.com/?ref_noscript"</span>&gt;comments powered by Disqus.&lt;/a&gt;&lt;/noscript&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/section&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure><p>改为</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;% <span class="keyword">if</span> (!index &amp;&amp; post.comments &amp;&amp; config.disqus_shortname)&#123; %&gt;</span><br><span class="line">  &lt;section id=<span class="string">"comments"</span>&gt;</span><br><span class="line">    &lt;!-- 多说评论框 start --&gt;</span><br><span class="line">    &lt;div class=<span class="string">"ds-thread"</span> data-thread-key=<span class="string">"&lt;%= post.layout %&gt;-&lt;%= post.slug %&gt;"</span> data-title=<span class="string">"&lt;%= post.title %&gt;"</span> data-url=<span class="string">"&lt;%= page.permalink %&gt;"</span>&gt;&lt;/div&gt;</span><br><span class="line">    &lt;!-- 多说评论框 end --&gt;</span><br><span class="line">    &lt;!-- 多说公共JS代码 start (一个网页只需插入一次) --&gt;</span><br><span class="line">    &lt;script <span class="built_in">type</span>=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">    var duoshuoQuery = &#123;short_name:<span class="string">'&lt;%= config.disqus_shortname %&gt;'</span>&#125;;</span><br><span class="line">      (<span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">        var ds = document.createElement(<span class="string">'script'</span>);</span><br><span class="line">        ds.type = <span class="string">'text/javascript'</span>;ds.async = <span class="literal">true</span>;</span><br><span class="line">        ds.src = (document.location.protocol == <span class="string">'https:'</span> ? <span class="string">'https:'</span> : <span class="string">'http:'</span>) + <span class="string">'//static.duoshuo.com/embed.js'</span>;</span><br><span class="line">        ds.charset = <span class="string">'UTF-8'</span>;</span><br><span class="line">        (document.getElementsByTagName(<span class="string">'head'</span>)[0] </span><br><span class="line">         || document.getElementsByTagName(<span class="string">'body'</span>)[0]).appendChild(ds);</span><br><span class="line">      &#125;)();</span><br><span class="line">      &lt;/script&gt;</span><br><span class="line">    &lt;!-- 多说公共JS代码 end --&gt;</span><br><span class="line">  &lt;/section&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure><h3 id="hexo-git-backup"><a href="#hexo-git-backup" class="headerlink" title="hexo-git-backup"></a>hexo-git-backup</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">安装备份插件</span><br><span class="line">参考网址：  https://github.com/coneycode/hexo-git-backup</span><br><span class="line">Update</span><br><span class="line"><span class="keyword">if</span> you install with --save, you must remove firstly when you update it.</span><br><span class="line">$ npm remove hexo-git-backup</span><br><span class="line">$ npm install hexo-git-backup --save</span><br><span class="line">--------------------------------------</span><br><span class="line">安装主题</span><br><span class="line">参考网址：   https://github.com/chaooo/hexo-theme-BlueLake</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/chaooo/hexo-theme-BlueLake.git themes/BlueLake</span><br><span class="line">-------------------------------------</span><br><span class="line">生成、部署</span><br><span class="line">hexo g</span><br><span class="line">hexo d</span><br><span class="line">hexo b</span><br><span class="line">hexo server -p 5000   【本地查看】</span><br></pre></td></tr></table></figure><h3 id="hexo-1"><a href="#hexo-1" class="headerlink" title="hexo"></a>hexo</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Hello World</title>
      <link href="/2017/11/30/hello-world/"/>
      <url>/2017/11/30/hello-world/</url>
      <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
      
      
    </entry>
    
  
  
</search>
